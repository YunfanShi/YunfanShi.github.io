<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jack's Warden | V16 The Wake Up Call</title>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #121212;
            --text-main: #e0e0e0;
            --text-dim: #757575;
            --accent-red: #ff3333;
            --accent-green: #00ff88;
            --accent-blue: #2979ff;
            --accent-purple: #d946ef;
            --accent-yellow: #ffcc00;
            --border: #222;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 50px;
        }

        /* === TOP ALERT BAR (NEW) === */
        .death-bar {
            background: #1a0505;
            border-bottom: 1px solid var(--accent-red);
            padding: 20px;
            text-align: center;
        }

        .death-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .death-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .death-val {
            font-family: 'JetBrains Mono';
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
        }

        .death-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
            color: #888;
        }

        .quote-box {
            margin-top: 15px;
            font-style: italic;
            color: var(--text-main);
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.4;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        /* HEADER */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-family: 'JetBrains Mono';
            font-weight: 800;
            color: var(--text-main);
            display: flex;
            flex-direction: column;
        }
        .brand span { font-size: 0.7rem; color: var(--text-dim); }

        .date-badge {
            background: #222;
            padding: 5px 12px;
            border-radius: 6px;
            font-family: 'JetBrains Mono';
            font-size: 0.9rem;
            border: 1px solid #333;
            display: flex; gap: 10px; align-items: center;
        }
        .nav-btn { cursor: pointer; color: #666; transition:0.2s; }
        .nav-btn:hover { color: white; transform: scale(1.1); }

        /* DASHBOARD */
        .dashboard {
            margin: 20px;
            background: #1a1a1a;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #333;
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 20px;
            align-items: center;
        }

        .finish-time {
            font-family: 'JetBrains Mono';
            font-size: 3rem;
            font-weight: 800;
            margin: 5px 0;
            color: var(--text-main);
        }
        .finish-time.safe { color: var(--accent-green); }
        .finish-time.danger { color: var(--accent-red); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .metric { font-size: 0.85rem; color: #888; display: flex; align-items: center; gap: 6px; }
        .metric strong { color: white; font-family: 'JetBrains Mono'; }

        /* TASK LIST */
        .section-header {
            padding: 0 25px; margin-top: 20px;
            font-size: 0.8rem; font-weight: 700; color: var(--text-dim); text-transform: uppercase;
        }

        .task-grid {
            margin: 10px 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr;
            align-items: center;
            gap: 15px;
            position: relative; overflow: hidden;
        }

        .task-card::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
            background: #333; transition: 0.3s;
        }
        .task-card.behind::before { background: var(--accent-red); }
        .task-card.done::before { background: var(--accent-green); }
        .task-card.done { opacity: 0.5; }

        .task-meta h3 { margin: 0; font-size: 1.1rem; }
        .task-meta p { margin: 5px 0 0; font-size: 0.8rem; color: var(--text-dim); }

        .task-input-area {
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px;
        }
        .input-row { display: flex; align-items: center; gap: 8px; }
        .num-input {
            width: 70px; text-align: center;
            font-family: 'JetBrains Mono'; font-size: 1.2rem;
            background: #000; border: 1px solid #333; color: white; padding: 8px; border-radius: 6px;
        }
        .num-input:focus { outline: 2px solid var(--accent-blue); }

        .task-status { text-align: right; }
        .gap-val { font-family: 'JetBrains Mono'; font-size: 1.4rem; font-weight: 800; color: var(--accent-red); }
        .gap-val.ok { color: var(--accent-green); }
        
        .math-breakdown {
            font-size: 0.7rem; color: #555; margin-top: 4px; font-family: 'JetBrains Mono';
            background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 4px; display: inline-block;
        }

        /* IELTS */
        .ielts-card {
            background: linear-gradient(145deg, #1a1a1a, #201a1a);
            border-color: #332222;
            grid-template-columns: 1fr; text-align: center;
        }
        .timer-big {
            font-size: 2.5rem; font-family: 'JetBrains Mono'; font-weight: 700; margin: 10px 0;
        }
        .ielts-controls {
            display: flex; justify-content: center; gap: 15px; margin-top: 15px;
        }
        .ielts-controls button {
            border: 1px solid #444; color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: 'Inter';
            display: flex; align-items: center; gap: 6px; transition: 0.2s;
        }
        .ielts-controls button.primary { background: var(--accent-blue); border-color: var(--accent-blue); }
        .ielts-controls button.primary:hover { opacity: 0.9; }
        
        .ielts-controls button.finish { 
            background: rgba(0, 255, 136, 0.1); border-color: var(--accent-green); color: var(--accent-green); 
        }
        .ielts-controls button.finish:hover { background: var(--accent-green); color: black; }

        /* TEMP TASKS */
        .add-row { display: flex; gap: 10px; margin: 0 20px; }
        .add-row input { background: #111; border: 1px solid #333; color: white; padding: 10px; border-radius: 6px; flex: 1; }
        .add-row button { background: #222; border: 1px solid #333; color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        .temp-list { margin: 10px 20px; display: flex; flex-direction: column; gap: 8px; }
        .temp-item { background: #161616; padding: 10px 15px; border-radius: 8px; display: flex; justify-content: space-between; border-left: 3px solid var(--accent-purple); }

    </style>
</head>
<body>

    <div class="death-bar">
        <div class="death-grid">
            <div class="death-stat">
                <div class="death-val" id="days-wasted" style="color: var(--accent-red)">0</div>
                <div class="death-label">Days Wasted (Since Jan 23)</div>
            </div>
            <div class="death-stat">
                <div class="death-val" id="days-left" style="color: var(--accent-yellow)">0</div>
                <div class="death-label">Days Remaining (To Feb 28)</div>
            </div>
        </div>
        <div class="quote-box" id="quote-display">
            "Loading motivation..."
        </div>
    </div>

    <header>
        <div class="brand">
            JACK'S WARDEN
            <span>V16.0 THE WAKE UP CALL</span>
        </div>
        <div class="date-badge">
            <span class="material-icons-round nav-btn" onclick="shiftDate(-1)">chevron_left</span>
            <span id="date-display">--</span>
            <span class="material-icons-round nav-btn" onclick="shiftDate(1)">chevron_right</span>
        </div>
    </header>

    <div class="dashboard">
        <div class="prediction-box">
            <div style="font-size: 0.8rem; color:var(--text-dim); text-transform:uppercase;">Estimated Finish / 预计完工</div>
            <div id="finish-time-display" class="finish-time">--:--</div>
            <div class="metric">
                <span class="material-icons-round" style="font-size:16px">timer</span>
                Work Left: <strong id="total-hours-left">0h 0m</strong>
            </div>
            <div style="font-size:0.7rem; color:#555; margin-top:10px;">
                * Deadline: 22:30 (10:30 PM)
            </div>
        </div>
        <div style="text-align:center">
            <span class="material-icons-round" id="status-icon-display" style="font-size: 60px; color: #333;">query_builder</span>
        </div>
    </div>

    <div class="section-header">Planned Missions</div>
    <div class="task-grid" id="main-task-list"></div>

    <div class="section-header">Temp Tasks</div>
    <div class="add-row">
        <input type="text" id="new-task-name" placeholder="Name">
        <input type="number" id="new-task-time" placeholder="Mins">
        <button onclick="addTempTask()">Add</button>
    </div>
    <div class="temp-list" id="temp-task-list"></div>

    <script>
        const RULES = { 'Physics': 40, 'Chemistry': 20, 'Biology': 20, 'Math': 30, 'Vocabulary': 0.5, 'DEFAULT': 30 };
        const PLAN = {
            "2026-02-06": [{"s": "IELTS DRILL (160m)", "t": 0, "type": "ielts"}, {"s": "Vocabulary", "t": 60, "type": "num"}, {"s": "Biology", "t": 7, "type": "num"}, {"s": "Math", "t": 3, "type": "num"}, {"s": "Physics", "t": 2, "type": "num"}, {"s": "Chemistry", "t": 4, "type": "num"}], 
            "2026-02-07": [{"s": "Biology", "t": 10, "type": "num"}, {"s": "Math", "t": 5, "type": "num"}, {"s": "Physics", "t": 3, "type": "num"}, {"s": "Chemistry", "t": 6, "type": "num"}], 
            "2026-02-08": [{"s": "Biology", "t": 13, "type": "num"}, {"s": "Math", "t": 7, "type": "num"}, {"s": "Physics", "t": 4, "type": "num"}, {"s": "Chemistry", "t": 8, "type": "num"}], 
            "2026-02-09": [{"s": "Biology", "t": 16, "type": "num"}, {"s": "Math", "t": 9, "type": "num"}, {"s": "Physics", "t": 5, "type": "num"}, {"s": "Chemistry", "t": 12, "type": "num"}], 
            "2026-02-10": [{"s": "Biology", "t": 21, "type": "num"}, {"s": "Physics", "t": 6, "type": "num"}], 
            "2026-02-15": [{"s": "IELTS DRILL", "t": 0, "type": "ielts"}, {"s": "Vocabulary", "t": 0, "type": "text"}], 
            "2026-02-20": [{"s": "IELTS DRILL", "t": 0, "type": "ielts"}, {"s": "Vocabulary", "t": 0, "type": "text"}], 
            "2026-02-27": [{"s": "IELTS DRILL", "t": 0, "type": "ielts"}, {"s": "Vocabulary", "t": 0, "type": "text"}]
        };

        const QUOTES = [
            "You have wasted enough time. The clock doesn't care about your feelings.",
            "Jan 23 was ages ago. What have you actually achieved?",
            "IGCSE results are permanent. Your excuses are temporary.",
            "February 28 is coming like a freight train. Move or get crushed.",
            "Stop pretending you're studying. Actually study.",
            "The gap between you and your goal is closing, but not in a good way.",
            "Pain of discipline or pain of regret. Pick one.",
            "Every minute you procrastinate is a point lost on the exam.",
            "Your competitors are studying right now. You are reading this.",
            "Don't let your future self hate you.",
            "Is this the best you can do? Prove it.",
            "Time is running out. Panic is the appropriate reaction.",
            "Sleep is for people who have finished their tasks.",
            "Do it now. Sometimes 'later' becomes 'never'."
        ];

        const DATE_KEYS = Object.keys(PLAN).sort();
        let STATE = { date: new Date(), dateStr: "", tempTasks: [], ieltsInterval: null };

        /* ================= LIFE COUNTDOWN ================= */
        function updateLifeStats() {
            const now = new Date();
            const start = new Date("2026-01-23");
            const end = new Date("2026-02-28");

            const wasted = Math.floor((now - start) / (1000 * 60 * 60 * 24));
            const left = Math.ceil((end - now) / (1000 * 60 * 60 * 24));

            document.getElementById('days-wasted').innerText = wasted;
            document.getElementById('days-left').innerText = left;

            // Random Quote
            const r = Math.floor(Math.random() * QUOTES.length);
            document.getElementById('quote-display').innerText = `"${QUOTES[r]}"`;
        }

        /* ================= HELPERS ================= */
        function getEffectiveProgress(subject, dateStr) {
            const cur = localStorage.getItem(`prog_${dateStr}_${subject}`);
            if(cur !== null) return parseInt(cur);
            const idx = DATE_KEYS.indexOf(dateStr);
            if(idx <= 0) return 0;
            for(let i = idx-1; i>=0; i--) {
                const prev = localStorage.getItem(`prog_${DATE_KEYS[i]}_${subject}`);
                if(prev !== null) return parseInt(prev);
            }
            return 0;
        }

        /* ================= CORE ================= */
        function init() {
            updateLifeStats();
            updateDateStr();
            loadTempTasks();
            render();
            setInterval(calcTime, 30000);
            calcTime();
        }

        function updateDateStr() {
            const y = STATE.date.getFullYear();
            const m = String(STATE.date.getMonth()+1).padStart(2,'0');
            const d = String(STATE.date.getDate()).padStart(2,'0');
            STATE.dateStr = `${y}-${m}-${d}`;
            document.getElementById('date-display').innerText = STATE.dateStr;
        }

        function shiftDate(d) {
            STATE.date.setDate(STATE.date.getDate()+d);
            updateDateStr();
            loadTempTasks();
            render();
            calcTime();
        }

        function render() {
            const list = document.getElementById('main-task-list');
            list.innerHTML = '';
            const tasks = PLAN[STATE.dateStr] || [];

            if(tasks.length === 0) list.innerHTML = `<div style="text-align:center; padding:20px; color:#555">No Plan</div>`;

            tasks.forEach(t => {
                const card = document.createElement('div');
                card.className = 'task-card';

                if(t.type === 'ielts' || t.s.includes('IELTS')) {
                    card.classList.add('ielts-card');
                    const saved = localStorage.getItem(`ielts_${STATE.dateStr}`);
                    const rem = saved ? parseInt(saved) : 160 * 60;
                    const isDone = rem <= 0;
                    if(isDone) card.classList.add('done');
                    
                    card.innerHTML = `
                        <div>
                            <div style="color:var(--accent-blue); font-weight:700">IELTS DRILL</div>
                            <div class="timer-big" id="ielts-display">${formatTime(rem)}</div>
                            <div class="ielts-controls">
                                <button class="primary" onclick="toggleIelts('${STATE.dateStr}')">
                                    <span class="material-icons-round">play_arrow</span> START / PAUSE
                                </button>
                                <button class="finish" onclick="finishIelts('${STATE.dateStr}')">
                                    <span class="material-icons-round">check_circle</span> MARK DONE
                                </button>
                            </div>
                        </div>
                    `;
                } 
                else if (t.type === 'num') {
                    const current = getEffectiveProgress(t.s, STATE.dateStr);
                    const gap = t.t - current;
                    const isDone = gap <= 0;
                    
                    if(isDone) card.classList.add('done');
                    else card.classList.add('behind');

                    let rate = RULES['DEFAULT'];
                    if(t.s.includes('Bio')) rate = RULES['Biology'];
                    if(t.s.includes('Chem')) rate = RULES['Chemistry'];
                    if(t.s.includes('Phy')) rate = RULES['Physics'];
                    if(t.s.includes('Math')) rate = RULES['Math'];
                    if(t.s.includes('Vocab')) rate = RULES['Vocabulary'];

                    const time = gap > 0 ? Math.ceil(gap * rate) : 0;
                    const step = t.s.includes('Vocab') ? 10 : 1;

                    card.innerHTML = `
                        <div class="task-meta">
                            <h3>${t.s}</h3>
                            <p>Target: <strong>${t.t}</strong></p>
                        </div>
                        <div class="task-input-area">
                            <span style="font-size:0.7rem; color:#666">Finished:</span>
                            <div class="input-row">
                                <input type="number" class="num-input" value="${current}" step="${step}" onchange="upd('${t.s}', this.value)">
                            </div>
                        </div>
                        <div class="task-status">
                            <div class="gap-val ${isDone?'ok':''}">${isDone ? 'DONE' : '-'+gap}</div>
                            <div class="math-breakdown">Gap ${gap} × ${rate}m = <strong>${time}m</strong></div>
                        </div>
                    `;
                } 
                else {
                    const done = localStorage.getItem(`check_${STATE.dateStr}_${t.s}`) === 'true';
                    if(done) card.classList.add('done');
                    card.innerHTML = `
                        <div class="task-meta" style="grid-column:span 2">
                            <h3>${t.s}</h3>
                            <p>Task</p>
                        </div>
                        <div class="task-status">
                            <input type="checkbox" ${done?'checked':''} onchange="chk('${t.s}', this.checked)" style="width:20px; height:20px;">
                        </div>
                    `;
                }
                list.appendChild(card);
            });
            renderTemp();
        }

        function upd(sub, val) {
            localStorage.setItem(`prog_${STATE.dateStr}_${sub}`, val);
            render(); calcTime();
        }
        function chk(sub, val) {
            localStorage.setItem(`check_${STATE.dateStr}_${sub}`, val);
            render(); calcTime();
        }

        function calcTime() {
            let mins = 0;
            const tasks = PLAN[STATE.dateStr] || [];
            
            tasks.forEach(t => {
                if(t.type === 'ielts' || t.s.includes('IELTS')) {
                    const s = localStorage.getItem(`ielts_${STATE.dateStr}`);
                    mins += Math.ceil((s ? parseInt(s) : 160*60)/60);
                } else if(t.type === 'num') {
                    const cur = getEffectiveProgress(t.s, STATE.dateStr);
                    const gap = t.t - cur;
                    if(gap > 0) {
                        let rate = 30;
                        if(t.s.includes('Bio')) rate = 20;
                        if(t.s.includes('Chem')) rate = 20;
                        if(t.s.includes('Phy')) rate = 40;
                        if(t.s.includes('Math')) rate = 30;
                        if(t.s.includes('Vocab')) rate = 0.5;
                        mins += (gap * rate);
                    }
                } else {
                    if(localStorage.getItem(`check_${STATE.dateStr}_${t.s}`) !== 'true') mins += 30;
                }
            });

            STATE.tempTasks.forEach(t => mins += t.m);

            const h = Math.floor(mins/60);
            const m = Math.ceil(mins%60);
            document.getElementById('total-hours-left').innerText = `${h}h ${m}m`;

            const now = new Date();
            let start = new Date();
            const workStart = new Date(); workStart.setHours(10,30,0,0);
            if(now < workStart) start = workStart; else start = now;

            const finish = new Date(start.getTime() + mins*60000);
            const dead = new Date(); dead.setHours(22,30,0,0);

            const disp = document.getElementById('finish-time-display');
            const icon = document.getElementById('status-icon-display');

            if(finish > dead || finish.getDate() > now.getDate()) {
                disp.innerText = "IMPOSSIBLE";
                disp.className = "finish-time danger";
                icon.innerText = "warning";
                icon.style.color = "var(--accent-red)";
            } else {
                disp.innerText = `${String(finish.getHours()).padStart(2,'0')}:${String(finish.getMinutes()).padStart(2,'0')}`;
                disp.className = "finish-time safe";
                icon.innerText = "check_circle";
                icon.style.color = "var(--accent-green)";
            }
        }

        function loadTempTasks() { 
            const r = localStorage.getItem(`temp_${STATE.dateStr}`);
            STATE.tempTasks = r ? JSON.parse(r) : [];
        }
        function addTempTask() {
            const n = document.getElementById('new-task-name').value;
            const t = parseInt(document.getElementById('new-task-time').value);
            if(n && t) {
                STATE.tempTasks.push({n, m:t});
                localStorage.setItem(`temp_${STATE.dateStr}`, JSON.stringify(STATE.tempTasks));
                document.getElementById('new-task-name').value='';
                document.getElementById('new-task-time').value='';
                renderTemp(); calcTime();
            }
        }
        function renderTemp() {
            const l = document.getElementById('temp-task-list');
            l.innerHTML = '';
            STATE.tempTasks.forEach((t,i) => {
                const el = document.createElement('div');
                el.className = 'temp-item';
                el.innerHTML = `<span>${t.n}</span><div style="display:flex;gap:10px;align-items:center"><span style="color:var(--accent-purple)">+${t.m}m</span><span style="color:red;cursor:pointer" onclick="delTemp(${i})">X</span></div>`;
                l.appendChild(el);
            });
        }
        function delTemp(i) {
            STATE.tempTasks.splice(i,1);
            localStorage.setItem(`temp_${STATE.dateStr}`, JSON.stringify(STATE.tempTasks));
            renderTemp(); calcTime();
        }

        function formatTime(s) {
            const h = Math.floor(s/3600);
            const m = Math.floor((s%3600)/60);
            const sc = s%60;
            return `${h}:${String(m).padStart(2,'0')}:${String(sc).padStart(2,'0')}`;
        }
        function toggleIelts(dateStr) {
            if(STATE.ieltsInterval) {
                clearInterval(STATE.ieltsInterval);
                STATE.ieltsInterval = null;
            } else {
                const k = `ielts_${dateStr}`;
                STATE.ieltsInterval = setInterval(() => {
                    let c = parseInt(localStorage.getItem(k));
                    if(isNaN(c)) c = 160*60;
                    if(c > 0) {
                        c--; localStorage.setItem(k, c);
                        const el = document.getElementById('ielts-display');
                        if(el) el.innerText = formatTime(c);
                        if(c%60===0) calcTime();
                    } else {
                        finishIelts(dateStr);
                    }
                }, 1000);
            }
        }
        function finishIelts(dateStr) {
            if(STATE.ieltsInterval) {
                clearInterval(STATE.ieltsInterval);
                STATE.ieltsInterval = null;
            }
            localStorage.setItem(`ielts_${dateStr}`, 0);
            render();
            calcTime();
        }

        init();
    </script>
</body>
</html>
