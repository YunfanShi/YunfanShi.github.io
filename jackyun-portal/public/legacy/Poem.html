<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script src="/legacy/supabase-adapter.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ²‰æµ¸èƒŒè¯µ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* --- æ ¸å¿ƒå˜é‡å®šä¹‰ --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --mask-color: #e0e6ed;
            --accent-color: #1a73e8;
            --accent-hover: #1557b0;
            --btn-secondary-bg: #f1f3f4;
            --btn-secondary-text: #5f6368;
            --color-success: #34a853; 
            --color-danger: #e74c3c; 
            --color-warning: #f1c40f;
            --font-poem: 'Noto Serif SC', 'Songti SC', serif;
            --transition-curve: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: var(--bg-gradient);
            font-family: 'Roboto', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- ä¸»å®¹å™¨ --- */
        .app-container {
            width: 90%;
            max-width: 1000px; 
            height: 85vh;
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08), 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.5s ease;
        }

        /* --- å¯¼èˆªæ  --- */
        .nav-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px 20px 0;
            border-bottom: 1px solid #f0f0f0;
            flex-shrink: 0;
        }
        .nav-tab {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .nav-tab:hover { color: var(--text-primary); }
        .nav-tab.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }

        /* --- å†…å®¹åŒºåŸŸ --- */
        .main-content {
            flex-grow: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .view-content {
            width: 100%;
            height: 100%;
            padding: 30px 40px;
            box-sizing: border-box;
            overflow-y: auto;
            display: none;
            flex-direction: column;
        }
        .view-content.active { display: flex; }

        /* --- è§†å›¾1: èƒŒè¯µ (Recitation) --- */
        #recitation-view { display: flex; flex-direction: row; }
        
        .recitation-input-panel {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            padding-right: 20px;
            overflow-y: auto;
        }
        .recitation-recommended-panel {
            flex: 1;
            padding-left: 20px;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* æœç´¢å’Œåˆ†ç±»æ  */
        .library-header { flex-shrink: 0; margin-bottom: 15px; }
        .search-box {
            width: 100%; padding: 10px 15px; border-radius: 8px; border: 1px solid #ddd;
            background: #f9f9f9; font-size: 14px; box-sizing: border-box; margin-bottom: 10px; outline: none;
        }
        .search-box:focus { border-color: var(--accent-color); background: #fff; }
        
        .category-tags { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .category-tags::-webkit-scrollbar { display: none; }
        .category-tag {
            padding: 4px 10px; border-radius: 12px; background: #f1f3f4; color: #5f6368;
            font-size: 12px; cursor: pointer; white-space: nowrap; transition: all 0.2s;
        }
        .category-tag.active { background: var(--accent-color); color: white; }

        .recitation-list-container { flex-grow: 1; overflow-y: auto; padding-right: 5px; }
        
        .title {
            font-family: var(--font-poem); font-size: 28px; color: var(--text-primary);
            margin-bottom: 5px; font-weight: 900; text-align: center; letter-spacing: 2px;
        }
        .subtitle { font-size: 14px; color: var(--text-secondary); margin-bottom: 20px; text-align: center; }

        .input-wrapper {
            flex-grow: 1; min-height: 200px; position: relative; border-radius: 16px;
            border: 2px solid #edf2f7; background: #fcfcfc; transition: border-color 0.3s;
            overflow: hidden; margin-bottom: 15px;
        }
        textarea {
            width: 100%; height: 100%; border: none; background: transparent; padding: 20px;
            font-family: var(--font-poem); font-size: 16px; line-height: 1.8; color: #444;
            resize: none; outline: none; box-sizing: border-box;
        }
        
        .action-bar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .btn {
            padding: 12px 20px; border-radius: 12px; font-size: 14px; font-weight: 500;
            cursor: pointer; border: none; display: flex; align-items: center; justify-content: center;
            gap: 6px; transition: all 0.2s; flex: 1;
        }
        .btn-primary { background: var(--accent-color); color: white; box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3); flex: 2; }
        .btn-primary:hover { background: var(--accent-hover); transform: translateY(-2px); }
        .btn-secondary { background: var(--btn-secondary-bg); color: var(--btn-secondary-text); }
        .btn-danger { background: #fee2e2; color: #c0392b; width: 100%; margin-top: 10px; }
        #continue-recitation-btn { background: var(--color-success); color: white; margin-bottom: 15px; display: none; width: 100%; box-sizing: border-box;}
        
        .poem-list-item {
            padding: 12px; margin-bottom: 8px; background: #f7f9fb; border-radius: 8px;
            cursor: pointer; font-size: 14px; color: var(--text-primary); transition: all 0.2s;
            line-height: 1.4; position: relative;
        }
        .poem-list-item:hover { background: #e9eff5; transform: translateX(2px); }
        .poem-list-item small { display: block; color: var(--text-secondary); font-size: 11px; margin-top: 4px; }
        .poem-status-tag { float: right; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 500; margin-left: 5px;}
        .status-completed { background: var(--color-success); color: white; }
        .status-in-progress { background: #fbbc04; color: #333; }

        /* --- è¿›åº¦æ¡ --- */
        .progress-bar-container { height: 4px; width: 100%; position: absolute; top: 0; left: 0; z-index: 1000; }
        .progress-fill { height: 100%; background: var(--accent-color); width: 0%; transition: width 0.4s ease; }
        #progress-percent { position: absolute; top: 10px; left: 0; transform: translateX(-50%); background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; opacity: 0; transition: left 0.4s ease, opacity 0.2s; pointer-events: none; }
        .is-reciting #progress-percent { opacity: 1; }

        /* --- èƒŒè¯µèˆå° (Poem View) --- */
        #poem-view-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--card-bg); z-index: 500; display: none; flex-direction: column;
        }
        #poem-view {
            height: 100%; overflow-y: auto; padding: 60px 20px 100px; box-sizing: border-box;
            text-align: center; scroll-behavior: smooth;
            scrollbar-width: none;
        }
        #poem-view::-webkit-scrollbar { display: none; }

        .poem-line { position: relative; margin: 24px auto; display: inline-block; max-width: 95%; }
        .break { display: block; width: 100%; height: 0; }
        .text-content {
            font-family: var(--font-poem); font-size: 32px; color: var(--text-primary);
            letter-spacing: 0.1em; opacity: 0; transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .is-title .text-content { font-size: 42px; font-weight: 900; color: #000; }
        .is-title { margin-bottom: 40px; }
        .mask {
            position: absolute; top: -5%; left: -5%; width: 110%; height: 110%;
            background: var(--mask-color); border-radius: 8px; cursor: pointer; z-index: 10;
            opacity: 1; transform: scale(1); filter: blur(0px); transition: all 0.6s var(--transition-curve);
        }
        .poem-line:hover .mask { background-color: #d1d9e6; }
        .poem-line.revealed .text-content { opacity: 1; transform: translateY(0); }
        .poem-line.revealed .mask { opacity: 0; transform: scale(1.15); filter: blur(12px); pointer-events: none; }

        /* é¡¶éƒ¨æŒ‰é’® */
        .top-icon-btn {
            position: absolute; top: 20px; width: 36px; height: 36px; border-radius: 50%;
            background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            color: #555; font-size: 18px; z-index: 1100; transition: all 0.2s;
        }
        .top-icon-btn:hover { transform: scale(1.1); }
        #btn-exit-recite { left: 20px; }
        #btn-restart-recite { left: 70px; color: var(--accent-color); }
        #btn-study-reveal { left: 120px; color: var(--color-warning); font-size: 16px; }
        #btn-pause-recite { left: 170px; font-size: 16px; } /* æ–°å¢æš‚åœæŒ‰é’® */

        .study-active { background-color: var(--color-warning) !important; color: #fff !important; }

        #recite-timer {
            position: absolute; top: 25px; right: 20px; 
            font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 16px; 
            color: var(--text-secondary); z-index: 1100;
            background: rgba(255,255,255,0.8); padding: 4px 10px; border-radius: 12px;
        }

        /* æš‚åœå…¨å±é®ç½© */
        #pause-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none; /* é»˜è®¤éšè— */
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .pause-text { font-family: var(--font-poem); font-size: 32px; color: var(--text-primary); font-weight: 900; margin-bottom: 20px; }
        .btn-resume { padding: 12px 40px; background: var(--accent-color); color: white; border: none; border-radius: 25px; font-size: 16px; cursor: pointer; box-shadow: 0 4px 15px rgba(26, 115, 232, 0.3); }

        /* ç§»åŠ¨ç«¯ä¸“ç”¨æ§åˆ¶æ  (åº•éƒ¨) */
        .mobile-controls {
            position: fixed;
            bottom: 0; left: 0; width: 100%; height: 80px;
            background: rgba(255,255,255,0.95);
            border-top: 1px solid #eee;
            display: none; /* é»˜è®¤éšè—ï¼Œé€šè¿‡ media query æ§åˆ¶ */
            align-items: center;
            justify-content: space-between;
            padding: 0 20px 10px;
            box-sizing: border-box;
            z-index: 1100;
            backdrop-filter: blur(10px);
        }
        .mobile-btn {
            flex: 1; height: 50px; border-radius: 12px; border: none;
            font-size: 16px; font-weight: 600; margin: 0 5px; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-prev { background: #95a5a6; }
        .btn-next { background: var(--accent-color); }
        .btn-study { background: var(--color-warning); color: #333; flex: 0.3; font-size: 14px; }
        .btn-mobile-pause { background: #9b59b6; color: white; flex: 0.3; } /* ç§»åŠ¨ç«¯æš‚åœ */
        .btn-prev:active, .btn-next:active { transform: scale(0.95); }

        /* æç¤ºå±‚ - ä»…æ¡Œé¢æ˜¾ç¤º */
        .hint-overlay {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.05); padding: 8px 16px; border-radius: 20px;
            font-size: 12px; color: #999; pointer-events: none;
            animation: fadeIn 2s 1s forwards; z-index: 1000;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- å®Œæˆç•Œé¢ (Completion View) --- */
        #completion-view {
            display: none; height: 100%; width: 100%; position: absolute; top: 0; left: 0;
            background: var(--card-bg); padding: 30px; box-sizing: border-box;
            align-items: center; justify-content: flex-start; flex-direction: column;
            text-align: center; opacity: 0; z-index: 1200; transition: opacity 0.4s ease;
            overflow-y: auto;
        }
        .completion-header { margin-top: 40px; margin-bottom: 20px; }
        .completion-title { font-family: var(--font-poem); font-size: 36px; font-weight: 900; margin-bottom: 10px; }
        .completion-score-card {
            background: #fff; width: 100%; max-width: 600px;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.06);
            padding: 25px; margin-bottom: 30px; border: 1px solid #f0f0f0;
        }
        .score-row { display: flex; justify-content: space-around; margin-bottom: 20px; text-align: center; }
        .score-item h4 { margin: 0 0 5px; color: #7f8c8d; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .score-item p { margin: 0; font-size: 24px; font-weight: 700; color: var(--text-primary); }
        .score-highlight { color: var(--color-success) !important; }

        .analysis-grid { display: flex; gap: 20px; width: 100%; max-width: 800px; text-align: left; }
        .analysis-col { flex: 1; background: #f9f9fb; border-radius: 16px; padding: 20px; }
        .analysis-col h3 { margin-top: 0; font-size: 16px; color: var(--text-primary); border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; align-items: center; gap: 8px;}
        .analysis-list { list-style: none; padding: 0; margin: 0; }
        .analysis-list li { 
            padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 14px; color: #555; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .analysis-list li:last-child { border-bottom: none; }
        .analysis-tag { font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .tag-red { background: #fee2e2; color: #c0392b; }
        .tag-blue { background: #e8f0fe; color: #1967d2; }

        /* --- å“åº”å¼é€‚é… (Media Queries) --- */
        @media (max-width: 768px) {
            body { background: var(--card-bg); height: 100%; align-items: flex-start; }
            .app-container { width: 100%; height: 100vh; max-width: none; border-radius: 0; box-shadow: none; }
            .nav-bar { padding: 10px 10px 0; }
            .nav-tab { font-size: 14px; padding: 10px; }
            .view-content { padding: 20px; }
            
            #recitation-view { flex-direction: column; }
            .recitation-input-panel { flex: none; border-bottom: 1px solid #eee; padding-bottom: 20px; padding-right: 0; margin-bottom: 20px; height: auto; max-height: 40vh; }
            .recitation-recommended-panel { padding-left: 0; border-left: none; flex: 1; border-top: 1px solid #f0f0f0; padding-top: 20px; }
            
            .input-wrapper { min-height: 120px; }
            .text-content { font-size: 24px; }
            .is-title .text-content { font-size: 32px; }
            
            .hint-overlay { display: none; }
            /* åªæœ‰åœ¨ç§»åŠ¨ç«¯æ‰æ˜¾ç¤ºåº•éƒ¨æ§åˆ¶æ  */
            .mobile-controls { display: flex; }
            
            /* éšè— PC ç«¯çš„æŸäº›é¡¶éƒ¨æŒ‰é’®ï¼Œé˜²æ­¢æ‹¥æŒ¤ï¼Œåªä¿ç•™é€€å‡º */
            #btn-restart-recite, #btn-study-reveal, #btn-pause-recite { display: none; }
            
            .analysis-grid { flex-direction: column; }
            .completion-title { font-size: 28px; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="progress-bar-container">
            <div class="progress-fill" id="progress-fill"></div>
            <span id="progress-percent">0%</span>
        </div>

        <div class="nav-bar" id="nav-bar">
            <div class="nav-tab active" data-view="recitation-view">ğŸ“œ èƒŒè¯µ</div>
            <div class="nav-tab" data-view="review-view">â±ï¸ å†å²</div>
            <div class="nav-tab" data-view="settings-view">âš™ï¸ è®¾ç½®</div>
        </div>

        <div class="main-content">
            <div id="recitation-view" class="view-content active">
                <div class="recitation-input-panel">
                    <div class="title">å¤è¯—èƒŒè¯µåŠ©æ‰‹</div>
                    <div class="subtitle">æ²‰æµ¸èƒŒè¯µ V3.2.0</div>

                    <button class="btn" id="continue-recitation-btn" onclick="continueLastPoem()">
                        ç»§ç»­èƒŒè¯µ <span id="continue-progress"></span>
                    </button>
                    
                    <div class="input-wrapper">
                        <textarea id="poem-input" placeholder="ç‚¹å‡»ä¸‹æ–¹åˆ—è¡¨é€‰æ‹©å¤è¯—ï¼Œæˆ–è€…åœ¨æ­¤ç²˜è´´æ–‡æœ¬..."></textarea>
                    </div>
                    
                    <div class="action-bar">
                        <input type="file" id="file-upload" accept=".txt" style="display: none;">
                        <label for="file-upload" class="btn btn-secondary">ğŸ“‚ æœ¬åœ°TXT</label>
                        <button class="btn btn-primary" onclick="startPoemFromInput()">å¼€å§‹èƒŒè¯µ</button>
                    </div>
                </div>

                <div class="recitation-recommended-panel">
                    <div class="library-header">
                        <input type="text" class="search-box" id="search-input" placeholder="ğŸ” æœç´¢æ ‡é¢˜æˆ–ä½œè€…...">
                        <div class="category-tags" id="category-filter">
                            <div class="category-tag active" data-cat="all">å…¨éƒ¨</div>
                            <div class="category-tag" data-cat="ä¹ä¸Š">ä¹å¹´çº§ä¸Šå†Œ</div>
                            <div class="category-tag" data-cat="ä¹ä¸‹">ä¹å¹´çº§ä¸‹å†Œ</div>
                        </div>
                    </div>
                    
                    <div id="recommended-list" class="recitation-list-container"></div>
                </div>
            </div>

            <div id="review-view" class="view-content">
                <h3>â±ï¸ èƒŒè¯µå†å²ä¸æˆç»©</h3>
                <div id="history-list"></div>
            </div>

            <div id="settings-view" class="view-content">
                <h3>âš™ï¸ è®¾ç½®</h3>
                <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #f0f0f0; border-radius: 12px;">
                    <label for="hide-step-input">â¬…ï¸ é€€å›è¡Œæ•°ï¼š</label>
                    <select id="hide-step-input" style="padding: 5px;">
                        <option value="1">1è¡Œ (é»˜è®¤)</option>
                        <option value="2">2è¡Œ</option>
                        <option value="3">3è¡Œ</option>
                    </select>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å†å²è®°å½•</button>
                </div>
                <p style="margin-top: 20px; color: #999; font-size: 12px;">æ²‰æµ¸èƒŒè¯µ V3.2.0</p>
            </div>
        </div>

        <div id="poem-view-container">
             <div id="btn-exit-recite" class="top-icon-btn" onclick="exitMidSession()" title="é€€å‡º">âœ•</div>
             <div id="btn-restart-recite" class="top-icon-btn" onclick="restartCurrentPoem()" title="é‡æ¥">â†»</div>
             <div id="btn-study-reveal" class="top-icon-btn" onclick="toggleStudyMode()" title="å­¦ä¹ æ¨¡å¼">ğŸ’¡</div>
             <div id="btn-pause-recite" class="top-icon-btn" onclick="togglePause()" title="æš‚åœ">â¸</div>
             
             <div id="recite-timer">00:00</div>

             <div id="pause-overlay">
                 <div class="pause-text">æš‚åœèƒŒè¯µ</div>
                 <button class="btn-resume" onclick="togglePause()">ç»§ç»­èƒŒè¯µ</button>
             </div>

            <div id="poem-view"></div>

            <div class="mobile-controls" id="mobile-controls">
                <button class="mobile-btn btn-prev" onclick="hidePrev()">ä¸Šä¸€å¥</button>
                <button class="mobile-btn btn-study" onclick="toggleStudyMode()">ğŸ’¡</button>
                <button class="mobile-btn btn-mobile-pause" onclick="togglePause()">â¸</button>
                <button class="mobile-btn btn-next" onclick="revealNext()">ä¸‹ä¸€å¥</button>
            </div>
        </div>
        
        <div id="completion-view">
            <div class="completion-header">
                <div class="completion-title" id="completion-title"></div>
                <div style="color: #7f8c8d;">ğŸ‰ èƒŒè¯µå®Œæˆ</div>
            </div>

            <div class="completion-score-card">
                <div class="score-row">
                    <div class="score-item">
                        <h4>æœ¬æ¬¡ç”¨æ—¶</h4>
                        <p id="score-time">00:00</p>
                    </div>
                    <div class="score-item">
                        <h4>å†å²æœ€ä½³</h4>
                        <p id="score-best">--:--</p>
                    </div>
                    <div class="score-item">
                        <h4>é€€å›æ¬¡æ•°</h4>
                        <p id="score-retreats">0</p>
                    </div>
                </div>
                <button class="btn btn-success" style="width: 100%;" onclick="goToHomeAfterCompletion()">è¿”å›ä¸»é¡µ</button>
            </div>

            <div class="analysis-grid">
                <div class="analysis-col">
                    <h3>ğŸ¤• æœ€éš¾èƒŒçš„å¥å­ <span style="font-weight: normal; font-size: 12px; margin-left: auto; color: #999;">(é€€å›æ¬¡æ•°æœ€å¤š)</span></h3>
                    <ul class="analysis-list" id="list-hardest">
                        <li><span>æš‚æ— æ•°æ®</span></li>
                    </ul>
                </div>
                <div class="analysis-col">
                    <h3>ğŸ§  æ€è€ƒæœ€ä¹…çš„å¥å­ <span style="font-weight: normal; font-size: 12px; margin-left: auto; color: #999;">(åœç•™æ—¶é—´æœ€é•¿)</span></h3>
                    <ul class="analysis-list" id="list-longest">
                        <li><span>æš‚æ— æ•°æ®</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="hint-overlay">
            å³é”® / â†’ ä¸‹ä¸€å¥ &nbsp; | &nbsp; å·¦é”® / â† ä¸Šä¸€å¥ &nbsp; | &nbsp; ğŸ’¡ ç‚¹å‡»ç¯æ³¡å­¦ä¹ 
        </div>
    </div>
    
    <script>
        // --- å¤è¯—æ•°æ® ---
        const POEM_LIBRARY = [
           // --- ä¹å¹´çº§ä¸Šå†Œ (æ–‡è¨€æ–‡/è¯—è¯) ---
            { category: "ä¹ä¸Š", title: "æ²å›­æ˜¥Â·é›ª", author: "æ¯›æ³½ä¸œ", content: "åŒ—å›½é£å…‰\nåƒé‡Œå†°å°\nä¸‡é‡Œé›ªé£˜\næœ›é•¿åŸå†…å¤–\næƒŸä½™è½è½\nå¤§æ²³ä¸Šä¸‹\né¡¿å¤±æ»”æ»”\nå±±èˆé“¶è›‡\nåŸé©°èœ¡è±¡\næ¬²ä¸å¤©å…¬è¯•æ¯”é«˜\né¡»æ™´æ—¥\nçœ‹çº¢è£…ç´ è£¹\nåˆ†å¤–å¦–å¨†\næ±Ÿå±±å¦‚æ­¤å¤šå¨‡\nå¼•æ— æ•°è‹±é›„ç«æŠ˜è…°\næƒœç§¦çš‡æ±‰æ­¦\nç•¥è¾“æ–‡é‡‡\nå”å®—å®‹ç¥–\nç¨é€Šé£éªš\nä¸€ä»£å¤©éª„\næˆå‰æ€æ±—\nåªè¯†å¼¯å¼“å°„å¤§é›•\nä¿±å¾€çŸ£\næ•°é£æµäººç‰©\nè¿˜çœ‹ä»Šæœ" },
            { category: "ä¹ä¸Š", title: "æˆ‘çˆ±è¿™åœŸåœ°", author: "è‰¾é’", content: "å‡å¦‚æˆ‘æ˜¯ä¸€åªé¸Ÿ\næˆ‘ä¹Ÿåº”è¯¥ç”¨å˜¶å“‘çš„å–‰å’™æ­Œå”±\nè¿™è¢«æš´é£é›¨æ‰€æ‰“å‡»ç€çš„åœŸåœ°\nè¿™æ°¸è¿œæ±¹æ¶Œç€æˆ‘ä»¬çš„æ‚²æ„¤çš„æ²³æµ\nè¿™æ— æ­¢æ¯åœ°å¹åˆ®ç€çš„æ¿€æ€’çš„é£\nå’Œé‚£æ¥è‡ªæ—é—´çš„æ— æ¯”æ¸©æŸ”çš„é»æ˜\nâ€”â€”ç„¶åæˆ‘æ­»äº†\nè¿ç¾½æ¯›ä¹Ÿè…çƒ‚åœ¨åœŸåœ°é‡Œé¢\nä¸ºä»€ä¹ˆæˆ‘çš„çœ¼é‡Œå¸¸å«æ³ªæ°´\nå› ä¸ºæˆ‘å¯¹è¿™åœŸåœ°çˆ±å¾—æ·±æ²‰" },
            { category: "ä¹ä¸Š", title: "å²³é˜³æ¥¼è®°", author: "èŒƒä»²æ·¹", content: "åº†å†å››å¹´æ˜¥\næ»•å­äº¬è°ªå®ˆå·´é™µéƒ¡\nè¶Šæ˜å¹´\næ”¿é€šäººå’Œ\nç™¾åºŸå…·å…´\nä¹ƒé‡ä¿®å²³é˜³æ¥¼\nå¢å…¶æ—§åˆ¶\nåˆ»å”è´¤ä»Šäººè¯—èµ‹äºå…¶ä¸Š\nå±äºˆä½œæ–‡ä»¥è®°ä¹‹\n\näºˆè§‚å¤«å·´é™µèƒœçŠ¶\nåœ¨æ´åº­ä¸€æ¹–\nè¡”è¿œå±±\nåé•¿æ±Ÿ\næµ©æµ©æ±¤æ±¤\næ¨ªæ— é™…æ¶¯\næœæ™–å¤•é˜´\næ°”è±¡ä¸‡åƒ\næ­¤åˆ™å²³é˜³æ¥¼ä¹‹å¤§è§‚ä¹Ÿ\nå‰äººä¹‹è¿°å¤‡çŸ£\nç„¶åˆ™åŒ—é€šå·«å³¡\nå—ææ½‡æ¹˜\nè¿å®¢éªšäºº\nå¤šä¼šäºæ­¤\nè§ˆç‰©ä¹‹æƒ…\nå¾—æ— å¼‚ä¹\n\nè‹¥å¤«æ·«é›¨éœéœ\nè¿æœˆä¸å¼€\né˜´é£æ€’å·\næµŠæµªæ’ç©º\næ—¥æ˜Ÿéšæ›œ\nå±±å²³æ½œå½¢\nå•†æ—…ä¸è¡Œ\næ¨¯å€¾æ¥«æ‘§\nè–„æš®å†¥å†¥\nè™å•¸çŒ¿å•¼\nç™»æ–¯æ¥¼ä¹Ÿ\nåˆ™æœ‰å»å›½æ€€ä¹¡\nå¿§è°—ç•è®¥\næ»¡ç›®è§ç„¶\næ„Ÿæè€Œæ‚²è€…çŸ£\n\nè‡³è‹¥æ˜¥å’Œæ™¯æ˜\næ³¢æ¾œä¸æƒŠ\nä¸Šä¸‹å¤©å…‰\nä¸€ç¢§ä¸‡é¡·\næ²™é¸¥ç¿”é›†\né”¦é³æ¸¸æ³³\nå²¸èŠ·æ±€å…°\néƒéƒé’é’\nè€Œæˆ–é•¿çƒŸä¸€ç©º\nçš“æœˆåƒé‡Œ\næµ®å…‰è·ƒé‡‘\né™å½±æ²‰ç’§\næ¸”æ­Œäº’ç­”\næ­¤ä¹ä½•æ\nç™»æ–¯æ¥¼ä¹Ÿ\nåˆ™æœ‰å¿ƒæ—·ç¥æ€¡\nå® è¾±å•å¿˜\næŠŠé…’ä¸´é£\nå…¶å–œæ´‹æ´‹è€…çŸ£\n\nå—Ÿå¤«\näºˆå°æ±‚å¤ä»äººä¹‹å¿ƒ\næˆ–å¼‚äºŒè€…ä¹‹ä¸º\nä½•å“‰\nä¸ä»¥ç‰©å–œ\nä¸ä»¥å·±æ‚²\nå±…åº™å ‚ä¹‹é«˜\nåˆ™å¿§å…¶æ°‘\nå¤„æ±Ÿæ¹–ä¹‹è¿œ\nåˆ™å¿§å…¶å›\næ˜¯è¿›äº¦å¿§\né€€äº¦å¿§\nç„¶åˆ™ä½•æ—¶è€Œä¹è€¶\nå…¶å¿…æ›°\nå…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§\nåå¤©ä¸‹ä¹‹ä¹è€Œä¹æ¬¤\nå™«\nå¾®æ–¯äºº\nå¾è°ä¸å½’" },
            { category: "ä¹ä¸Š", title: "é†‰ç¿äº­è®°", author: "æ¬§é˜³ä¿®", content: "ç¯æ»çš†å±±ä¹Ÿ\nå…¶è¥¿å—è¯¸å³°\næ—å£‘å°¤ç¾\næœ›ä¹‹è”šç„¶è€Œæ·±ç§€è€…\nç…çŠä¹Ÿ\nå±±è¡Œå…­ä¸ƒé‡Œ\næ¸é—»æ°´å£°æ½ºæ½º\nè€Œæ³»å‡ºäºä¸¤å³°ä¹‹é—´è€…\né…¿æ³‰ä¹Ÿ\nå³°å›è·¯è½¬\næœ‰äº­ç¿¼ç„¶ä¸´äºæ³‰ä¸Šè€…\né†‰ç¿äº­ä¹Ÿ\nä½œäº­è€…è°\nå±±ä¹‹åƒ§æ™ºä»™ä¹Ÿ\nåä¹‹è€…è°\nå¤ªå®ˆè‡ªè°“ä¹Ÿ\nå¤ªå®ˆä¸å®¢æ¥é¥®äºæ­¤\né¥®å°‘è¾„é†‰\nè€Œå¹´åˆæœ€é«˜\næ•…è‡ªå·æ›°é†‰ç¿ä¹Ÿ\né†‰ç¿ä¹‹æ„ä¸åœ¨é…’\nåœ¨ä¹å±±æ°´ä¹‹é—´ä¹Ÿ\nå±±æ°´ä¹‹ä¹\nå¾—ä¹‹å¿ƒè€Œå¯“ä¹‹é…’ä¹Ÿ\n\nè‹¥å¤«æ—¥å‡ºè€Œæ—éœå¼€\näº‘å½’è€Œå²©ç©´æš\næ™¦æ˜å˜åŒ–è€…\nå±±é—´ä¹‹æœæš®ä¹Ÿ\né‡èŠ³å‘è€Œå¹½é¦™\nä½³æœ¨ç§€è€Œç¹é˜´\né£éœœé«˜æ´\næ°´è½è€ŒçŸ³å‡ºè€…\nå±±é—´ä¹‹å››æ—¶ä¹Ÿ\næœè€Œå¾€\næš®è€Œå½’\nå››æ—¶ä¹‹æ™¯ä¸åŒ\nè€Œä¹äº¦æ— ç©·ä¹Ÿ\n\nè‡³äºè´Ÿè€…æ­Œäºé€”\nè¡Œè€…ä¼‘äºæ ‘\nå‰è€…å‘¼\nåè€…åº”\nä¼›å»ææº\nå¾€æ¥è€Œä¸ç»è€…\næ»äººæ¸¸ä¹Ÿ\nä¸´æºªè€Œæ¸”\næºªæ·±è€Œé±¼è‚¥\né…¿æ³‰ä¸ºé…’\næ³‰é¦™è€Œé…’æ´Œ\nå±±è‚´é‡è”Œ\næ‚ç„¶è€Œå‰é™ˆè€…\nå¤ªå®ˆå®´ä¹Ÿ\nå®´é…£ä¹‹ä¹\néä¸éç«¹\nå°„è€…ä¸­\nå¼ˆè€…èƒœ\nè§¥ç­¹äº¤é”™\nèµ·åè€Œå–§å“—è€…\nä¼—å®¾æ¬¢ä¹Ÿ\nè‹é¢œç™½å‘\né¢“ç„¶ä¹å…¶é—´è€…\nå¤ªå®ˆé†‰ä¹Ÿ\n\nå·²è€Œå¤•é˜³åœ¨å±±\näººå½±æ•£ä¹±\nå¤ªå®ˆå½’è€Œå®¾å®¢ä»ä¹Ÿ\næ ‘æ—é˜´ç¿³\né¸£å£°ä¸Šä¸‹\næ¸¸äººå»è€Œç¦½é¸Ÿä¹ä¹Ÿ\nç„¶è€Œç¦½é¸ŸçŸ¥å±±æ—ä¹‹ä¹\nè€Œä¸çŸ¥äººä¹‹ä¹\näººçŸ¥ä»å¤ªå®ˆæ¸¸è€Œä¹\nè€Œä¸çŸ¥å¤ªå®ˆä¹‹ä¹å…¶ä¹ä¹Ÿ\né†‰èƒ½åŒå…¶ä¹\né†’èƒ½è¿°ä»¥æ–‡è€…\nå¤ªå®ˆä¹Ÿ\nå¤ªå®ˆè°“è°\nåºé™µæ¬§é˜³ä¿®ä¹Ÿ" },
            { category: "ä¹ä¸Š", title: "æ¹–å¿ƒäº­çœ‹é›ª", author: "å¼ å²±", content: "å´‡ç¥¯äº”å¹´åäºŒæœˆ\nä½™ä½è¥¿æ¹–\nå¤§é›ªä¸‰æ—¥\næ¹–ä¸­äººé¸Ÿå£°ä¿±ç»\næ˜¯æ—¥æ›´å®šçŸ£\nä½™æ‹ä¸€å°èˆŸ\næ‹¥æ¯³è¡£ç‚‰ç«\nç‹¬å¾€æ¹–å¿ƒäº­çœ‹é›ª\né›¾å‡‡æ²†ç €\nå¤©ä¸äº‘ä¸å±±ä¸æ°´\nä¸Šä¸‹ä¸€ç™½\næ¹–ä¸Šå½±å­\næƒŸé•¿å ¤ä¸€ç—•\næ¹–å¿ƒäº­ä¸€ç‚¹\nä¸ä½™èˆŸä¸€èŠ¥\nèˆŸä¸­äººä¸¤ä¸‰ç²’è€Œå·²\n\nåˆ°äº­ä¸Š\næœ‰ä¸¤äººé“ºæ¯¡å¯¹å\nä¸€ç«¥å­çƒ§é…’ç‚‰æ­£æ²¸\nè§ä½™å¤§å–œæ›°\næ¹–ä¸­ç„‰å¾—æ›´æœ‰æ­¤äºº\næ‹‰ä½™åŒé¥®\nä½™å¼ºé¥®ä¸‰å¤§ç™½è€Œåˆ«\né—®å…¶å§“æ°\næ˜¯é‡‘é™µäºº\nå®¢æ­¤\nåŠä¸‹èˆ¹\nèˆŸå­å–ƒå–ƒæ›°\nè«è¯´ç›¸å…¬ç—´\næ›´æœ‰ç—´ä¼¼ç›¸å…¬è€…" },
            { category: "ä¹ä¸Š", title: "è¡Œè·¯éš¾Â·å…¶ä¸€", author: "æç™½", content: "é‡‘æ¨½æ¸…é…’æ–—ååƒ\nç‰ç›˜çç¾ç›´ä¸‡é’±\nåœæ¯æŠ•ç®¸ä¸èƒ½é£Ÿ\næ‹”å‰‘å››é¡¾å¿ƒèŒ«ç„¶\næ¬²æ¸¡é»„æ²³å†°å¡å·\nå°†ç™»å¤ªè¡Œé›ªæ»¡å±±\né—²æ¥å‚é’“ç¢§æºªä¸Š\nå¿½å¤ä¹˜èˆŸæ¢¦æ—¥è¾¹\nè¡Œè·¯éš¾\nè¡Œè·¯éš¾\nå¤šæ­§è·¯\nä»Šå®‰åœ¨\né•¿é£ç ´æµªä¼šæœ‰æ—¶\nç›´æŒ‚äº‘å¸†æµæ²§æµ·" },
            { category: "ä¹ä¸Š", title: "é…¬ä¹å¤©æ‰¬å·åˆé€¢å¸­ä¸Šè§èµ ", author: "åˆ˜ç¦¹é”¡", content: "å·´å±±æ¥šæ°´å‡„å‡‰åœ°\näºŒåä¸‰å¹´å¼ƒç½®èº«\næ€€æ—§ç©ºåŸé—»ç¬›èµ‹\nåˆ°ä¹¡ç¿»ä¼¼çƒ‚æŸ¯äºº\næ²‰èˆŸä¾§ç•”åƒå¸†è¿‡\nç—…æ ‘å‰å¤´ä¸‡æœ¨æ˜¥\nä»Šæ—¥å¬å›æ­Œä¸€æ›²\næš‚å‡­æ¯é…’é•¿ç²¾ç¥" },
            { category: "ä¹ä¸Š", title: "æ°´è°ƒæ­Œå¤´", author: "è‹è½¼", content: "æ˜æœˆå‡ æ—¶æœ‰\næŠŠé…’é—®é’å¤©\nä¸çŸ¥å¤©ä¸Šå®«é˜™\nä»Šå¤•æ˜¯ä½•å¹´\næˆ‘æ¬²ä¹˜é£å½’å»\nåˆæç¼æ¥¼ç‰å®‡\né«˜å¤„ä¸èƒœå¯’\nèµ·èˆå¼„æ¸…å½±\nä½•ä¼¼åœ¨äººé—´\n\nè½¬æœ±é˜\nä½ç»®æˆ·\nç…§æ— çœ \nä¸åº”æœ‰æ¨\nä½•äº‹é•¿å‘åˆ«æ—¶åœ†\näººæœ‰æ‚²æ¬¢ç¦»åˆ\næœˆæœ‰é˜´æ™´åœ†ç¼º\næ­¤äº‹å¤éš¾å…¨\nä½†æ„¿äººé•¿ä¹…\nåƒé‡Œå…±å©µå¨Ÿ" },
            { category: "ä¹ä¸Š", title: "æœˆå¤œå¿†èˆå¼Ÿ", author: "æœç”«", content: "æˆé¼“æ–­äººè¡Œ\nè¾¹ç§‹ä¸€é›å£°\néœ²ä»ä»Šå¤œç™½\næœˆæ˜¯æ•…ä¹¡æ˜\næœ‰å¼Ÿçš†åˆ†æ•£\næ— å®¶é—®æ­»ç”Ÿ\nå¯„ä¹¦é•¿ä¸è¾¾\nå†µä¹ƒæœªä¼‘å…µ" },
            { category: "ä¹ä¸Š", title: "é•¿æ²™è¿‡è´¾è°Šå®…", author: "åˆ˜é•¿å¿", content: "ä¸‰å¹´è°ªå®¦æ­¤æ –è¿Ÿ\nä¸‡å¤æƒŸç•™æ¥šå®¢æ‚²\nç§‹è‰ç‹¬å¯»äººå»å\nå¯’æ—ç©ºè§æ—¥æ–œæ—¶\næ±‰æ–‡æœ‰é“æ©çŠ¹è–„\næ¹˜æ°´æ— æƒ…åŠå²‚çŸ¥\nå¯‚å¯‚æ±Ÿå±±æ‘‡è½å¤„\næ€œå›ä½•äº‹åˆ°å¤©æ¶¯" },
            // æ–°å¢ä¹ä¸Šç¯‡ç›®
            { category: "ä¹ä¸Š", title: "ç™»é£æ¥å³°", author: "ç‹å®‰çŸ³", content: "é£æ¥å±±ä¸Šåƒå¯»å¡”\né—»è¯´é¸¡é¸£è§æ—¥å‡\nä¸ç•æµ®äº‘é®æœ›çœ¼\nè‡ªç¼˜èº«åœ¨æœ€é«˜å±‚" },
            { category: "ä¹ä¸Š", title: "èµ¤å£", author: "æœç‰§", content: "æŠ˜æˆŸæ²‰æ²™é“æœªé”€\nè‡ªå°†ç£¨æ´—è®¤å‰æœ\nä¸œé£ä¸ä¸å‘¨éƒä¾¿\né“œé›€æ˜¥æ·±é”äºŒä¹”" },
            { category: "ä¹ä¸Š", title: "è¿‡é›¶ä¸æ´‹", author: "æ–‡å¤©ç¥¥", content: "è¾›è‹¦é­é€¢èµ·ä¸€ç»\nå¹²æˆˆå¯¥è½å››å‘¨æ˜Ÿ\nå±±æ²³ç ´ç¢é£é£˜çµ®\nèº«ä¸–æµ®æ²‰é›¨æ‰“è\næƒ¶ææ»©å¤´è¯´æƒ¶æ\né›¶ä¸æ´‹é‡Œå¹é›¶ä¸\näººç”Ÿè‡ªå¤è°æ— æ­»\nç•™å–ä¸¹å¿ƒç…§æ±—é’" },
            { category: "ä¹ä¸Š", title: "å¤©å‡€æ²™Â·ç§‹æ€", author: "ç™½æœ´", content: "å­¤æ‘è½æ—¥æ®‹éœ\nè½»çƒŸè€æ ‘å¯’é¸¦\nä¸€ç‚¹é£é¸¿å½±ä¸‹\né’å±±ç»¿æ°´\nç™½è‰çº¢å¶é»„èŠ±" },
            { category: "ä¹ä¸Š", title: "åˆ«äº‘é—´", author: "å¤å®Œæ·³", content: "ä¸‰å¹´ç¾æ—…å®¢\nä»Šæ—¥åˆå—å† \næ— é™å±±æ²³æ³ª\nè°è¨€å¤©åœ°å®½\nç‹¬æ€œå¤©åœ°çª„\nä¸è§åœ£å›é¢œ\nè½¬çœ¼ç‰¢ç¬¼é—­\nå§‹çŸ¥çœŸæ˜¯éš¾" },

            // --- ä¹å¹´çº§ä¸‹å†Œ (æ–‡è¨€æ–‡/è¯—è¯) ---
            { category: "ä¹ä¸‹", title: "é±¼æˆ‘æ‰€æ¬²ä¹Ÿ", author: "å­Ÿå­", content: "é±¼\næˆ‘æ‰€æ¬²ä¹Ÿ\nç†ŠæŒ\näº¦æˆ‘æ‰€æ¬²ä¹Ÿ\näºŒè€…ä¸å¯å¾—å…¼\nèˆé±¼è€Œå–ç†ŠæŒè€…ä¹Ÿ\nç”Ÿ\näº¦æˆ‘æ‰€æ¬²ä¹Ÿ\nä¹‰\näº¦æˆ‘æ‰€æ¬²ä¹Ÿ\näºŒè€…ä¸å¯å¾—å…¼\nèˆç”Ÿè€Œå–ä¹‰è€…ä¹Ÿ\nç”Ÿäº¦æˆ‘æ‰€æ¬²\næ‰€æ¬²æœ‰ç”šäºç”Ÿè€…\næ•…ä¸ä¸ºè‹Ÿå¾—ä¹Ÿ\næ­»äº¦æˆ‘æ‰€æ¶\næ‰€æ¶æœ‰ç”šäºæ­»è€…\næ•…æ‚£æœ‰æ‰€ä¸è¾Ÿä¹Ÿ\nå¦‚ä½¿äººä¹‹æ‰€æ¬²è«ç”šäºç”Ÿ\nåˆ™å‡¡å¯ä»¥å¾—ç”Ÿè€…\nä½•ä¸ç”¨ä¹Ÿ\nä½¿äººä¹‹æ‰€æ¶è«ç”šäºæ­»è€…\nåˆ™å‡¡å¯ä»¥è¾Ÿæ‚£è€Œæœ‰ä¸ä¸ºä¹Ÿ\nç”±æ˜¯åˆ™ç”Ÿè€Œæœ‰ä¸ç”¨ä¹Ÿ\nç”±æ˜¯åˆ™å¯ä»¥è¾Ÿæ‚£è€Œæœ‰ä¸ä¸ºä¹Ÿ\næ˜¯æ•…æ‰€æ¬²æœ‰ç”šäºç”Ÿè€…\næ‰€æ¶æœ‰ç”šäºæ­»è€…\néç‹¬è´¤è€…æœ‰æ˜¯å¿ƒä¹Ÿ\näººçš†æœ‰ä¹‹\nè´¤è€…èƒ½å‹¿ä¸§è€³\n\nä¸€ç®ªé£Ÿ\nä¸€è±†ç¾¹\nå¾—ä¹‹åˆ™ç”Ÿ\nå¼—å¾—åˆ™æ­»\nå‘¼å°”è€Œä¸ä¹‹\nè¡Œé“ä¹‹äººå¼—å—\nè¹´å°”è€Œä¸ä¹‹\nä¹äººä¸å±‘ä¹Ÿ\nä¸‡é’Ÿåˆ™ä¸è¾©ç¤¼ä¹‰è€Œå—ä¹‹\nä¸‡é’Ÿäºæˆ‘ä½•åŠ ç„‰\nä¸ºå®«å®¤ä¹‹ç¾\nå¦»å¦¾ä¹‹å¥‰\næ‰€è¯†ç©·ä¹è€…å¾—æˆ‘ä¸\nä¹¡ä¸ºèº«æ­»è€Œä¸å—\nä»Šä¸ºå®«å®¤ä¹‹ç¾ä¸ºä¹‹\nä¹¡ä¸ºèº«æ­»è€Œä¸å—\nä»Šä¸ºå¦»å¦¾ä¹‹å¥‰ä¸ºä¹‹\nä¹¡ä¸ºèº«æ­»è€Œä¸å—\nä»Šä¸ºæ‰€è¯†ç©·ä¹è€…å¾—æˆ‘è€Œä¸ºä¹‹\næ˜¯äº¦ä¸å¯ä»¥å·²ä¹\næ­¤ä¹‹è°“å¤±å…¶æœ¬å¿ƒ" },
            { category: "ä¹ä¸‹", title: "é€ä¸œé˜³é©¬ç”Ÿåº", author: "å®‹æ¿‚", content: "ä½™å¹¼æ—¶å³å—œå­¦\nå®¶è´«\næ— ä»è‡´ä¹¦ä»¥è§‚\næ¯å‡å€Ÿäºè—ä¹¦ä¹‹å®¶\næ‰‹è‡ªç¬”å½•\nè®¡æ—¥ä»¥è¿˜\nå¤©å¤§å¯’\nç šå†°åš\næ‰‹æŒ‡ä¸å¯å±ˆä¼¸\nå¼—ä¹‹æ€ \nå½•æ¯•\nèµ°é€ä¹‹\nä¸æ•¢ç¨é€¾çº¦\nä»¥æ˜¯äººå¤šä»¥ä¹¦å‡ä½™\nä½™å› å¾—éè§‚ç¾¤ä¹¦\næ—¢åŠ å† \nç›Šæ…•åœ£è´¤ä¹‹é“\nåˆæ‚£æ— ç¡•å¸ˆåäººä¸æ¸¸\nå°è¶‹ç™¾é‡Œå¤–\nä»ä¹¡ä¹‹å…ˆè¾¾æ‰§ç»å©é—®\nå…ˆè¾¾å¾·éš†æœ›å°Š\né—¨äººå¼Ÿå­å¡«å…¶å®¤\næœªå°ç¨é™è¾è‰²\nä½™ç«‹ä¾å·¦å³\næ´ç–‘è´¨ç†\nä¿¯èº«å€¾è€³ä»¥è¯·\næˆ–é‡å…¶å±å’„\nè‰²æ„ˆæ­\nç¤¼æ„ˆè‡³\nä¸æ•¢å‡ºä¸€è¨€ä»¥å¤\nä¿Ÿå…¶æ¬£æ‚¦\nåˆ™åˆè¯·ç„‰\næ•…ä½™è™½æ„š\nå’è·æœ‰æ‰€é—»\n\nå½“ä½™ä¹‹ä»å¸ˆä¹Ÿ\nè´Ÿç®§æ›³å±£è¡Œæ·±å±±å·¨è°·ä¸­\nç©·å†¬çƒˆé£\nå¤§é›ªæ·±æ•°å°º\nè¶³è‚¤çš²è£‚è€Œä¸çŸ¥\nè‡³èˆ\nå››æ”¯åƒµåŠ²ä¸èƒ½åŠ¨\nåªµäººæŒæ±¤æ²ƒçŒ\nä»¥è¡¾æ‹¥è¦†\nä¹…è€Œä¹ƒå’Œ\nå¯“é€†æ—…\nä¸»äººæ—¥å†é£Ÿ\næ— é²œè‚¥æ»‹å‘³ä¹‹äº«\nåŒèˆç”Ÿçš†è¢«ç»®ç»£\næˆ´æœ±ç¼¨å®é¥°ä¹‹å¸½\nè…°ç™½ç‰ä¹‹ç¯\nå·¦ä½©åˆ€\nå³å¤‡å®¹è‡­\nçƒ¨ç„¶è‹¥ç¥äºº\nä½™åˆ™ç¼Šè¢æ•è¡£å¤„å…¶é—´\nç•¥æ— æ…•è‰³æ„\nä»¥ä¸­æœ‰è¶³ä¹è€…\nä¸çŸ¥å£ä½“ä¹‹å¥‰ä¸è‹¥äººä¹Ÿ\nç›–ä½™ä¹‹å‹¤ä¸”è‰°è‹¥æ­¤" },
            { category: "ä¹ä¸‹", title: "æ›¹åˆ¿è®ºæˆ˜", author: "å·¦ä¼ ", content: "åå¹´æ˜¥\né½å¸ˆä¼æˆ‘\nå…¬å°†æˆ˜\næ›¹åˆ¿è¯·è§\nå…¶ä¹¡äººæ›°\nè‚‰é£Ÿè€…è°‹ä¹‹\nåˆä½•é—´ç„‰\nåˆ¿æ›°\nè‚‰é£Ÿè€…é„™\næœªèƒ½è¿œè°‹\nä¹ƒå…¥è§\né—®\nä½•ä»¥æˆ˜\nå…¬æ›°\nè¡£é£Ÿæ‰€å®‰\nå¼—æ•¢ä¸“ä¹Ÿ\nå¿…ä»¥åˆ†äºº\nå¯¹æ›°\nå°æƒ æœªé\næ°‘å¼—ä»ä¹Ÿ\nå…¬æ›°\nç‰ºç‰²ç‰å¸›\nå¼—æ•¢åŠ ä¹Ÿ\nå¿…ä»¥ä¿¡\nå¯¹æ›°\nå°ä¿¡æœªå­š\nç¥å¼—ç¦ä¹Ÿ\nå…¬æ›°\nå°å¤§ä¹‹ç‹±\nè™½ä¸èƒ½å¯Ÿ\nå¿…ä»¥æƒ…\nå¯¹æ›°\nå¿ ä¹‹å±ä¹Ÿ\nå¯ä»¥ä¸€æˆ˜\næˆ˜åˆ™è¯·ä»\n\nå…¬ä¸ä¹‹ä¹˜\næˆ˜äºé•¿å‹º\nå…¬å°†é¼“ä¹‹\nåˆ¿æ›°æœªå¯\né½äººä¸‰é¼“\nåˆ¿æ›°å¯çŸ£\né½å¸ˆè´¥ç»©\nå…¬å°†é©°ä¹‹\nåˆ¿æ›°æœªå¯\nä¸‹è§†å…¶è¾™\nç™»è½¼è€Œæœ›ä¹‹\næ›°å¯çŸ£\né‚é€é½å¸ˆ\n\næ—¢å…‹\nå…¬é—®å…¶æ•…\nå¯¹æ›°\nå¤«æˆ˜\nå‹‡æ°”ä¹Ÿ\nä¸€é¼“ä½œæ°”\nå†è€Œè¡°\nä¸‰è€Œç«­\nå½¼ç«­æˆ‘ç›ˆ\næ•…å…‹ä¹‹\nå¤«å¤§å›½\néš¾æµ‹ä¹Ÿ\næƒ§æœ‰ä¼ç„‰\nå¾è§†å…¶è¾™ä¹±\næœ›å…¶æ——é¡\næ•…é€ä¹‹" },
            { category: "ä¹ä¸‹", title: "é‚¹å¿Œè®½é½ç‹çº³è°", author: "æˆ˜å›½ç­–", content: "é‚¹å¿Œä¿®å…«å°ºæœ‰ä½™\nè€Œå½¢è²Œæ˜³ä¸½\næœæœè¡£å† \nçª¥é•œ\nè°“å…¶å¦»æ›°\næˆ‘å­°ä¸åŸåŒ—å¾å…¬ç¾\nå…¶å¦»æ›°\nå›ç¾ç”š\nå¾å…¬ä½•èƒ½åŠå›ä¹Ÿ\nåŸåŒ—å¾å…¬\né½å›½ä¹‹ç¾ä¸½è€…ä¹Ÿ\nå¿Œä¸è‡ªä¿¡\nè€Œå¤é—®å…¶å¦¾æ›°\nå¾å­°ä¸å¾å…¬ç¾\nå¦¾æ›°\nå¾å…¬ä½•èƒ½åŠå›ä¹Ÿ\næ—¦æ—¥\nå®¢ä»å¤–æ¥\nä¸åè°ˆ\né—®ä¹‹å®¢æ›°\nå¾ä¸å¾å…¬å­°ç¾\nå®¢æ›°\nå¾å…¬ä¸è‹¥å›ä¹‹ç¾ä¹Ÿ\næ˜æ—¥å¾å…¬æ¥\nå­°è§†ä¹‹\nè‡ªä»¥ä¸ºä¸å¦‚\nçª¥é•œè€Œè‡ªè§†\nåˆå¼—å¦‚è¿œç”š\næš®å¯è€Œæ€ä¹‹\næ›°\nå¾å¦»ä¹‹ç¾æˆ‘è€…\nç§æˆ‘ä¹Ÿ\nå¦¾ä¹‹ç¾æˆ‘è€…\nç•æˆ‘ä¹Ÿ\nå®¢ä¹‹ç¾æˆ‘è€…\næ¬²æœ‰æ±‚äºæˆ‘ä¹Ÿ\n\näºæ˜¯å…¥æœè§å¨ç‹\næ›°\nè‡£è¯šçŸ¥ä¸å¦‚å¾å…¬ç¾\nè‡£ä¹‹å¦»ç§è‡£\nè‡£ä¹‹å¦¾ç•è‡£\nè‡£ä¹‹å®¢æ¬²æœ‰æ±‚äºè‡£\nçš†ä»¥ç¾äºå¾å…¬\nä»Šé½åœ°æ–¹åƒé‡Œ\nç™¾äºŒååŸ\nå®«å¦‡å·¦å³è«ä¸ç§ç‹\næœå»·ä¹‹è‡£è«ä¸ç•ç‹\nå››å¢ƒä¹‹å†…è«ä¸æœ‰æ±‚äºç‹\nç”±æ­¤è§‚ä¹‹\nç‹ä¹‹è”½ç”šçŸ£\n\nç‹æ›°\nå–„\nä¹ƒä¸‹ä»¤\nç¾¤è‡£åæ°‘\nèƒ½é¢åˆºå¯¡äººä¹‹è¿‡è€…\nå—ä¸Šèµ\nä¸Šä¹¦è°å¯¡äººè€…\nå—ä¸­èµ\nèƒ½è°¤è®¥äºå¸‚æœ\né—»å¯¡äººä¹‹è€³è€…\nå—ä¸‹èµ\nä»¤åˆä¸‹\nç¾¤è‡£è¿›è°\né—¨åº­è‹¥å¸‚\næ•°æœˆä¹‹å\næ—¶æ—¶è€Œé—´è¿›\næœŸå¹´ä¹‹å\nè™½æ¬²è¨€\næ— å¯è¿›è€…\nç‡•èµµéŸ©é­é—»ä¹‹\nçš†æœäºé½\næ­¤æ‰€è°“æˆ˜èƒœäºæœå»·" },
            { category: "ä¹ä¸‹", title: "å‡ºå¸ˆè¡¨", author: "è¯¸è‘›äº®", content: "å…ˆå¸åˆ›ä¸šæœªåŠè€Œä¸­é“å´©æ®‚\nä»Šå¤©ä¸‹ä¸‰åˆ†\nç›Šå·ç–²å¼Š\næ­¤è¯šå±æ€¥å­˜äº¡ä¹‹ç§‹ä¹Ÿ\nç„¶ä¾å«ä¹‹è‡£ä¸æ‡ˆäºå†…\nå¿ å¿—ä¹‹å£«å¿˜èº«äºå¤–è€…\nç›–è¿½å…ˆå¸ä¹‹æ®Šé‡\næ¬²æŠ¥ä¹‹äºé™›ä¸‹ä¹Ÿ\nè¯šå®œå¼€å¼ åœ£å¬\nä»¥å…‰å…ˆå¸é—å¾·\næ¢å¼˜å¿—å£«ä¹‹æ°”\nä¸å®œå¦„è‡ªè²è–„\nå¼•å–»å¤±ä¹‰\nä»¥å¡å¿ è°ä¹‹è·¯ä¹Ÿ\n\nå®«ä¸­åºœä¸­\nä¿±ä¸ºä¸€ä½“\né™Ÿç½šè‡§å¦\nä¸å®œå¼‚åŒ\nè‹¥æœ‰ä½œå¥¸çŠ¯ç§‘åŠä¸ºå¿ å–„è€…\nå®œä»˜æœ‰å¸è®ºå…¶åˆ‘èµ\nä»¥æ˜­é™›ä¸‹å¹³æ˜ä¹‹ç†\nä¸å®œåç§\nä½¿å†…å¤–å¼‚æ³•ä¹Ÿ\n\nä¾ä¸­ä¾éƒéƒ­æ”¸ä¹‹\nè´¹ç¥\nè‘£å…ç­‰\næ­¤çš†è‰¯å®\nå¿—è™‘å¿ çº¯\næ˜¯ä»¥å…ˆå¸ç®€æ‹”ä»¥é—é™›ä¸‹\næ„šä»¥ä¸ºå®«ä¸­ä¹‹äº‹\näº‹æ— å¤§å°\næ‚‰ä»¥å’¨ä¹‹\nç„¶åæ–½è¡Œ\nå¿…èƒ½è£¨è¡¥é˜™æ¼\næœ‰æ‰€å¹¿ç›Š\n\nå°†å†›å‘å® \næ€§è¡Œæ·‘å‡\næ™“ç•…å†›äº‹\nè¯•ç”¨äºæ˜”æ—¥\nå…ˆå¸ç§°ä¹‹æ›°èƒ½\næ˜¯ä»¥ä¼—è®®ä¸¾å® ä¸ºç£\næ„šä»¥ä¸ºè¥ä¸­ä¹‹äº‹\næ‚‰ä»¥å’¨ä¹‹\nå¿…èƒ½ä½¿è¡Œé˜µå’Œç¦\nä¼˜åŠ£å¾—æ‰€\n\näº²è´¤è‡£\nè¿œå°äºº\næ­¤å…ˆæ±‰æ‰€ä»¥å…´éš†ä¹Ÿ\näº²å°äºº\nè¿œè´¤è‡£\næ­¤åæ±‰æ‰€ä»¥å€¾é¢“ä¹Ÿ\nå…ˆå¸åœ¨æ—¶\næ¯ä¸è‡£è®ºæ­¤äº‹\næœªå°ä¸å¹æ¯ç—›æ¨äºæ¡“çµä¹Ÿ\nä¾ä¸­å°šä¹¦é•¿å²å‚å†›\næ­¤æ‚‰è´è‰¯æ­»èŠ‚ä¹‹è‡£\næ„¿é™›ä¸‹äº²ä¹‹ä¿¡ä¹‹\nåˆ™æ±‰å®¤ä¹‹éš†\nå¯è®¡æ—¥è€Œå¾…ä¹Ÿ\n\nè‡£æœ¬å¸ƒè¡£\nèº¬è€•äºå—é˜³\nè‹Ÿå…¨æ€§å‘½äºä¹±ä¸–\nä¸æ±‚é—»è¾¾äºè¯¸ä¾¯\nå…ˆå¸ä¸ä»¥è‡£å‘é„™\nçŒ¥è‡ªæ‰å±ˆ\nä¸‰é¡¾è‡£äºè‰åºä¹‹ä¸­\nå’¨è‡£ä»¥å½“ä¸–ä¹‹äº‹\nç”±æ˜¯æ„Ÿæ¿€\né‚è®¸å…ˆå¸ä»¥é©±é©°\nåå€¼å€¾è¦†\nå—ä»»äºè´¥å†›ä¹‹é™…\nå¥‰å‘½äºå±éš¾ä¹‹é—´\nå°”æ¥äºŒåæœ‰ä¸€å¹´çŸ£\n\nå…ˆå¸çŸ¥è‡£è°¨æ…\næ•…ä¸´å´©å¯„è‡£ä»¥å¤§äº‹ä¹Ÿ\nå—å‘½ä»¥æ¥\nå¤™å¤œå¿§å¹\nææ‰˜ä»˜ä¸æ•ˆ\nä»¥ä¼¤å…ˆå¸ä¹‹æ˜\næ•…äº”æœˆæ¸¡æ³¸\næ·±å…¥ä¸æ¯›\nä»Šå—æ–¹å·²å®š\nå…µç”²å·²è¶³\nå½“å¥–ç‡ä¸‰å†›\nåŒ—å®šä¸­åŸ\nåº¶ç«­é©½é’\næ”˜é™¤å¥¸å‡¶\nå…´å¤æ±‰å®¤\nè¿˜äºæ—§éƒ½\næ­¤è‡£æ‰€ä»¥æŠ¥å…ˆå¸è€Œå¿ é™›ä¸‹ä¹‹èŒåˆ†ä¹Ÿ\nè‡³äºæ–Ÿé…ŒæŸç›Š\nè¿›å°½å¿ è¨€\nåˆ™æ”¸ä¹‹ç¥å…ä¹‹ä»»ä¹Ÿ\n\næ„¿é™›ä¸‹æ‰˜è‡£ä»¥è®¨è´¼å…´å¤ä¹‹æ•ˆ\nä¸æ•ˆåˆ™æ²»è‡£ä¹‹ç½ª\nä»¥å‘Šå…ˆå¸ä¹‹çµ\nè‹¥æ— å…´å¾·ä¹‹è¨€\nåˆ™è´£æ”¸ä¹‹ç¥å…ç­‰ä¹‹æ…¢\nä»¥å½°å…¶å’\né™›ä¸‹äº¦å®œè‡ªè°‹\nä»¥å’¨è¯¹å–„é“\nå¯Ÿçº³é›…è¨€\næ·±è¿½å…ˆå¸é—è¯\nè‡£ä¸èƒœå—æ©æ„Ÿæ¿€\nä»Šå½“è¿œç¦»\nä¸´è¡¨æ¶•é›¶\nä¸çŸ¥æ‰€è¨€" },
            { category: "ä¹ä¸‹", title: "å—ä¹¡å­Â·ç™»äº¬å£åŒ—å›ºäº­æœ‰æ€€", author: "è¾›å¼ƒç–¾", content: "ä½•å¤„æœ›ç¥å·\næ»¡çœ¼é£å…‰åŒ—å›ºæ¥¼\nåƒå¤å…´äº¡å¤šå°‘äº‹\næ‚ æ‚ \nä¸å°½é•¿æ±Ÿæ»šæ»šæµ\nå¹´å°‘ä¸‡å…œéª\nåæ–­ä¸œå—æˆ˜æœªä¼‘\nå¤©ä¸‹è‹±é›„è°æ•Œæ‰‹\næ›¹åˆ˜\nç”Ÿå­å½“å¦‚å­™ä»²è°‹" },
            { category: "ä¹ä¸‹", title: "å±±å¡ç¾ŠÂ·æ½¼å…³æ€€å¤", author: "å¼ å…»æµ©", content: "å³°å³¦å¦‚èš\næ³¢æ¶›å¦‚æ€’\nå±±æ²³è¡¨é‡Œæ½¼å…³è·¯\næœ›è¥¿éƒ½\næ„è¸Œèº‡\nä¼¤å¿ƒç§¦æ±‰ç»è¡Œå¤„\nå®«é˜™ä¸‡é—´éƒ½åšäº†åœŸ\nå…´\nç™¾å§“è‹¦\näº¡\nç™¾å§“è‹¦" },
            { category: "ä¹ä¸‹", title: "ç ´é˜µå­Â·ä¸ºé™ˆåŒç”«èµ‹å£®è¯ä»¥å¯„ä¹‹", author: "è¾›å¼ƒç–¾", content: "é†‰é‡ŒæŒ‘ç¯çœ‹å‰‘\næ¢¦å›å¹è§’è¿è¥\nå…«ç™¾é‡Œåˆ†éº¾ä¸‹ç‚™\näº”åå¼¦ç¿»å¡å¤–å£°\næ²™åœºç§‹ç‚¹å…µ\né©¬ä½œçš„å¢é£å¿«\nå¼“å¦‚éœ¹é›³å¼¦æƒŠ\näº†å´å›ç‹å¤©ä¸‹äº‹\nèµ¢å¾—ç”Ÿå‰èº«åå\nå¯æ€œç™½å‘ç”Ÿ" },
            // æ–°å¢ä¹ä¸‹ç¯‡ç›®
            { category: "ä¹ä¸‹", title: "æµ£æºªæ²™Â·è°é“äººç”Ÿæ— å†å°‘", author: "è‹è½¼", content: "è°é“äººç”Ÿæ— å†å°‘\né—¨å‰æµæ°´å°šèƒ½è¥¿\nä¼‘å°†ç™½å‘å”±é»„é¸¡\n\næ˜¨æ—¥æ˜¥é£è¾æ•…é‡Œ\nä»Šæœè½æ—¥å¿†é•¿å®‰\nå¿½æ€èº«ä¸–äº”åå¹´" },
            { category: "ä¹ä¸‹", title: "è¥¿æ±ŸæœˆÂ·å¤œè¡Œé»„æ²™é“ä¸­", author: "è¾›å¼ƒç–¾", content: "æ˜æœˆåˆ«ææƒŠé¹Š\næ¸…é£åŠå¤œé¸£è‰\nç¨»èŠ±é¦™é‡Œè¯´ä¸°å¹´\nå¬å–è›™å£°ä¸€ç‰‡\n\nä¸ƒå…«ä¸ªæ˜Ÿå¤©å¤–\nä¸¤ä¸‰ç‚¹é›¨å±±å‰\næ—§æ—¶èŒ…åº—ç¤¾æ—è¾¹\nè·¯è½¬æºªå¤´å¿½è§" },
            { category: "ä¹ä¸‹", title: "å¤ªå¸¸å¼•Â·å»ºåº·ä¸­ç§‹å¤œ", author: "è¾›å¼ƒç–¾", content: "ä¸€è½®ç§‹å½±è½¬é‡‘æ³¢\né£é•œåˆé‡ç£¨\næŠŠé…’é—®å§®å¨¥\n'è¢«ç™½å‘\næ¬ºäººå¥ˆä½•'\n\nä¹˜é£å¥½å»\nè«ç­‰é—²\næ„å¦‚è®¸\nä½•æ—¥å¤å½’æ¥\næ±Ÿå±±çŸ¥æœ‰å¾…\n'å¾…ä¸æˆ‘\nå…±ä¸´'?" },
            { category: "ä¹ä¸‹", title: "æ— é¢˜", author: "æå•†éš", content: "ç›¸è§æ—¶éš¾åˆ«äº¦éš¾\nä¸œé£æ— åŠ›ç™¾èŠ±æ®‹\næ˜¥èš•åˆ°æ­»ä¸æ–¹å°½\nèœ¡ç‚¬æˆç°æ³ªå§‹å¹²\næ™“é•œä½†æ„äº‘é¬“æ”¹\nå¤œåŸåº”è§‰æœˆå…‰å¯’\nè“¬è±æ­¤å»æ— å¤šè·¯\né’é¸Ÿæ®·å‹¤ä¸ºæ¢çœ‹" },
            { category: "ä¹ä¸‹", title: "åœç®—å­Â·å’æ¢…", author: "é™†æ¸¸", content: "é©¿å¤–æ–­æ¡¥è¾¹\nå¯‚å¯å¼€æ— ä¸»\nå·²æ˜¯é»„æ˜ç‹¬è‡ªæ„\næ›´è‘—é£å’Œé›¨\n\næ— æ„è‹¦äº‰æ˜¥\nä¸€ä»»ç¾¤èŠ³å¦’\né›¶è½æˆæ³¥ç¢¾ä½œå°˜\nåªæœ‰é¦™å¦‚æ•…" },
        ];

        // --- å…¨å±€å˜é‡ ---
        const poemViewContainer = document.getElementById('poem-view-container');
        const poemView = document.getElementById('poem-view');
        const completionView = document.getElementById('completion-view'); 
        const poemInput = document.getElementById('poem-input');
        const recommendedList = document.getElementById('recommended-list');
        const searchInput = document.getElementById('search-input');
        const categoryTagsContainer = document.getElementById('category-filter');
        const recommendedPanel = document.querySelector('.recitation-recommended-panel'); 
        
        let linesData = [];
        let currentIndex = -1;
        let hideStep = 1; 
        let currentPoemTitle = ""; 
        let currentPoemContent = ""; 
        let lastViewId = 'recitation-view';
        let currentCategory = 'all';

        // ç»Ÿè®¡ä¸è®¡æ—¶å˜é‡
        let startTime = null;
        let timerInterval = null;
        let lineStats = []; // æ ¼å¼: [{index:0, retreats:0, duration:0, lastRevealTime: 0}, ...]
        let isStudyMode = false;
        let isPaused = false;
        let pausedTimeDuration = 0; // è®°å½•å·²æš‚åœçš„æ—¶é•¿(å¦‚æœéœ€è¦) - å®é™…é€»è¾‘ä½¿ç”¨é‡æ–°è®¡ç®—startTime

        // --- å·¥å…·å‡½æ•° ---

        function parsePoemLines(text) {
            if (!text) return [];
            return text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
        }

        function isMobile() {
            return window.innerWidth <= 768; 
        }

        // æ ¼å¼åŒ–æ—¶é—´ (ç§’ -> MM:SS)
        function formatTime(seconds) {
            if(!seconds || isNaN(seconds)) return "00:00";
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }
        
        // æ ¼å¼åŒ–çŸ­æ—¶é—´ (ç§’ -> 3.5s)
        function formatDuration(seconds) {
            return seconds.toFixed(1) + 's';
        }

        // --- å­˜å‚¨ä¸è®¾ç½® ---

        function loadHistory() {
            try { return JSON.parse(localStorage.getItem('poemHistory')) || []; } catch { return []; }
        }

        function loadBestTime(title) {
            const history = loadHistory();
            const completed = history.filter(p => p.title === title && p.status === 'completed' && p.totalTime);
            if (completed.length === 0) return null;
            return Math.min(...completed.map(p => p.totalTime));
        }

        // ä¿®æ”¹ï¼šç°åœ¨å³ä½¿æ˜¯ in-progress çŠ¶æ€ä¹Ÿä¼šä¿å­˜ lineStats (stats)
        function saveOrUpdateHistory(title, content, progress, status, totalTime = 0, currentStats = null) {
            if (isStudyMode) return; 

            let history = loadHistory();
            const fullTextForCount = `${title}\n${content}`;
            const cleanData = parsePoemLines(fullTextForCount);
            const totalLines = cleanData.length; 

            let newItem = { 
                title, 
                content, 
                date: new Date().toISOString(), 
                progress, 
                totalLines, 
                status,
                totalTime: totalTime,
                stats: currentStats // å…³é”®ï¼šä¿å­˜ç»Ÿè®¡æ•°æ®
            };
            
            let existingIdx = history.findIndex(p => p.title === title);
            if(existingIdx > -1) {
                history.splice(existingIdx, 1);
            }
            history.unshift(newItem);
            localStorage.setItem('poemHistory', JSON.stringify(history.slice(0, 30)));
        }

        function loadSettings() {
            const settings = localStorage.getItem('poemSettings');
            if (settings) {
                const s = JSON.parse(settings);
                hideStep = s.hideStep || 1;
                document.getElementById('hide-step-input').value = hideStep;
            }
        }
        function saveSettings() {
            localStorage.setItem('poemSettings', JSON.stringify({ hideStep }));
        }

        // --- è§†å›¾æ¸²æŸ“ ---

        function switchView(id) {
            document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            const targetTab = document.querySelector(`.nav-tab[data-view="${id}"]`);
            if (targetTab) targetTab.classList.add('active');
            
            if (recommendedPanel) {
                recommendedPanel.style.display = (id === 'recitation-view') ? 'flex' : 'none';
            }
            renderMain();
        }

        function renderStatusTag(poem) {
            const total = poem.totalLines || 0;
            const revealedCount = poem.progress + 1;
            
            if (poem.status === 'completed') return `<span class="poem-status-tag status-completed">âœ… å·²å®Œæˆ</span>`;
            if (revealedCount > 0 && revealedCount <= total) {
                let pct = Math.round((revealedCount / total) * 100);
                if (revealedCount === total) pct = 99; // é¿å…æœªå®Œæˆæ˜¾ç¤º100%
                return `<span class="poem-status-tag status-in-progress">${pct}%</span>`;
            }
            return `<span class="poem-status-tag" style="background:#eee; color:#999">æœªå¼€å§‹</span>`;
        }

        function renderLibrary() {
            recommendedList.innerHTML = '';
            const history = loadHistory();
            const historyMap = new Map(history.map(p => [p.title, p]));
            const searchTerm = searchInput.value.toLowerCase().trim();

            const filtered = POEM_LIBRARY.filter(p => {
                const matchCat = currentCategory === 'all' || p.category === currentCategory;
                const matchSearch = p.title.toLowerCase().includes(searchTerm) || p.author.toLowerCase().includes(searchTerm);
                return matchCat && matchSearch;
            });

            if(filtered.length === 0) {
                recommendedList.innerHTML = '<div style="padding:20px; text-align:center; color:#999;">æœªæ‰¾åˆ°ç›¸å…³å¤è¯—</div>';
                return;
            }

            filtered.forEach(p => {
                const fullText = `${p.title}\n${p.content}`;
                const calculatedTotal = parsePoemLines(fullText).length;
                
                const hist = historyMap.get(p.title) || {
                    title: p.title, author: p.author, content: p.content,
                    progress: -1, totalLines: calculatedTotal, status: 'new'
                };
                
                const item = document.createElement('div');
                item.className = 'poem-list-item';
                item.innerHTML = `${renderStatusTag(hist)}<strong>${p.title}</strong><small>[${p.category}] ${p.author}</small>`;
                
                item.onclick = () => {
                    poemInput.value = `${p.title}\n${p.author}\n\n${p.content}`;
                    let loadIndex = hist.progress;
                    if (hist.status === 'completed') {
                        if(!confirm(`ã€Š${p.title}ã€‹å·²èƒŒè¯µå®Œæˆï¼Œæ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ`)) return;
                        loadIndex = -1;
                    }
                    directStartPoem(p.title, p.content, loadIndex);
                };
                recommendedList.appendChild(item);
            });
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            const history = loadHistory();
            if(!history.length) list.innerHTML = '<p style="color:#aaa; text-align:center;">æš‚æ— è®°å½•</p>';
            
            history.forEach(p => {
                const d = document.createElement('div');
                d.className = 'poem-list-item';
                const date = new Date(p.date).toLocaleDateString();
                let info = `æ—¥æœŸï¼š${date}`;
                if (p.totalTime) info += ` | ç”¨æ—¶: ${formatTime(p.totalTime)}`;
                
                d.innerHTML = `${renderStatusTag(p)}<strong>${p.title}</strong><small>${info}</small>`;
                d.onclick = () => directStartPoem(p.title, p.content, p.progress);
                list.appendChild(d);
            });
        }

        function checkContinue() {
            const last = loadHistory().find(p => p.status === 'in-progress' && p.progress < p.totalLines - 1);
            const btn = document.getElementById('continue-recitation-btn');
            if(last) {
                const revealedCount = last.progress + 1;
                let pct = last.totalLines ? Math.round((revealedCount / last.totalLines) * 100) : 0;
                if (revealedCount === last.totalLines) pct = 99;
                
                btn.style.display = 'flex';
                document.getElementById('continue-progress').textContent = ` - ${last.title} (${pct}%)`;
                btn.onclick = () => directStartPoem(last.title, last.content, last.progress);
            } else {
                btn.style.display = 'none';
            }
        }
        
        function renderMain() {
            renderLibrary(); renderHistory(); checkContinue();
        }

        // --- æ ¸å¿ƒèƒŒè¯µé€»è¾‘ ---

        function directStartPoem(title, content, index) {
            lastViewId = document.getElementById('review-view').classList.contains('active') ? 'review-view' : 'recitation-view';
            currentPoemTitle = title;
            currentPoemContent = content;
            startRecitation(title + '\n' + content, index);
        }

        function startPoemFromInput() {
            const text = poemInput.value.trim();
            if(!text) return alert("è¯·å…ˆé€‰æ‹©å¤è¯—æˆ–ç²˜è´´æ–‡æœ¬");
            const lines = parsePoemLines(text);
            if(lines.length > 0) {
                currentPoemTitle = lines[0];
                const firstBreak = text.indexOf('\n');
                currentPoemContent = firstBreak > -1 ? text.substring(firstBreak + 1).trim() : '';
                startRecitation(text, -1);
            }
        }

        function startRecitation(text, initialIndex) {
            linesData = parsePoemLines(text);
            currentIndex = initialIndex;
            isStudyMode = false;
            isPaused = false;
            document.getElementById('pause-overlay').style.display = 'none';
            
            // --- æ ¸å¿ƒï¼šç»§æ‰¿/åˆå§‹åŒ–æ•°æ® ---
            const history = loadHistory().find(p => p.title === currentPoemTitle);
            let inheritedTime = 0;

            // åˆå§‹åŒ– lineStats
            lineStats = linesData.map((_, idx) => ({ 
                index: idx, retreats: 0, duration: 0, lastRevealTime: 0 
            }));

            // å¦‚æœæ˜¯ç»§ç»­èƒŒè¯µ (initialIndex > -1)ï¼Œå°è¯•åŠ è½½å†å²æ•°æ®
            if (initialIndex > -1 && history) {
                // ç»§æ‰¿æ—¶é—´
                if (history.totalTime) inheritedTime = history.totalTime;
                // ç»§æ‰¿ç»Ÿè®¡æ•°æ® (å¦‚æœæœ‰ä¿å­˜çš„è¯)
                if (history.stats && Array.isArray(history.stats)) {
                    // åˆå¹¶æ•°æ®ï¼Œç¡®ä¿é•¿åº¦ä¸€è‡´
                    lineStats = linesData.map((_, idx) => {
                        const saved = history.stats.find(s => s.index === idx);
                        return saved ? {...saved, lastRevealTime: 0} : {index: idx, retreats:0, duration:0, lastRevealTime:0};
                    });
                }
            }

            // è®¡ç®—èµ·å§‹æ—¶é—´æˆ³ (å½“å‰æ—¶é—´ - å·²è¿‡æ—¶é—´)
            startTime = Date.now() - (inheritedTime * 1000);

            // ä¿å­˜åˆå§‹/ç»§æ‰¿åçš„çŠ¶æ€
            saveOrUpdateHistory(currentPoemTitle, currentPoemContent, currentIndex, 'in-progress', inheritedTime, lineStats);

            // DOM æ„å»º
            poemView.innerHTML = '';
            linesData.forEach((line, i) => {
                const div = document.createElement('div');
                div.className = 'poem-line' + (i === 0 ? ' is-title' : '');
                div.innerHTML = `<div class="text-content">${line}</div><div class="mask"></div>`;
                poemView.appendChild(div);
                poemView.appendChild(document.createElement('div')).className = 'break';
            });
            poemView.appendChild(document.createElement('div')).style.height = isMobile() ? '150px' : '60px';

            // æ˜¾ç¤ºç•Œé¢
            poemViewContainer.style.display = 'flex';
            setTimeout(() => poemViewContainer.style.opacity = 1, 50);

            // æ¢å¤å·²æ­ç¤ºè¡Œ
            if(currentIndex >= 0) {
                const els = document.querySelectorAll('.poem-line');
                for(let i=0; i<=currentIndex; i++) els[i].classList.add('revealed');
                if(els[currentIndex]) {
                    els[currentIndex].scrollIntoView({block: 'center', behavior: 'instant'}); 
                    // æ¢å¤æ—¶ï¼Œé‡ç½®å½“å‰è¡Œçš„è®¡æ—¶ç‚¹
                    lineStats[currentIndex].lastRevealTime = Date.now();
                }
            } else {
                poemView.scrollTo({top:0, behavior:'instant'});
            }

            // æ›´æ–°UI
            document.querySelectorAll('#btn-study-reveal, .btn-study').forEach(b => b.classList.remove('study-active'));
            startTimer();
            updateProgress();
        }

        function startTimer() {
            clearInterval(timerInterval);
            const timerEl = document.getElementById('recite-timer');
            
            // ç«‹å³åˆ·æ–°ä¸€æ¬¡æ˜¾ç¤º
            if (startTime) {
                 timerEl.textContent = formatTime((Date.now() - startTime) / 1000);
            }

            timerInterval = setInterval(() => {
                if(!isStudyMode && !isPaused && startTime) {
                    const diff = (Date.now() - startTime) / 1000;
                    timerEl.textContent = formatTime(diff);
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // --- æš‚åœåŠŸèƒ½ ---
        function togglePause() {
            if (isStudyMode) return; // å­¦ä¹ æ¨¡å¼æ— éœ€æš‚åœï¼ˆå·²ç»åœäº†ï¼‰

            const overlay = document.getElementById('pause-overlay');
            
            if (isPaused) {
                // æ¢å¤
                isPaused = false;
                overlay.style.display = 'none';
                
                // æ ¸å¿ƒï¼šæ¢å¤æ—¶é—´ = å½“å‰æ—¶é—´ - ä¹‹å‰è®°å½•çš„å·²ç”¨æ—¶é•¿
                // æˆ‘ä»¬åœ¨æš‚åœæ—¶è®°å½•äº† accumulatedTimeï¼Œæ¢å¤æ—¶åæ¨ startTime
                // ç®€ä¾¿æ–¹æ³•ï¼šstartTime = Date.now() - (pausedTimeDuration * 1000)
                startTime = Date.now() - (pausedTimeDuration * 1000);
                
                // é‡ç½®å½“å‰è¡Œçš„è®¡æ—¶ç‚¹ (é˜²æ­¢æš‚åœæ—¶é—´ç®—å…¥æ€è€ƒæ—¶é—´)
                if (currentIndex >= 0 && lineStats[currentIndex]) {
                    lineStats[currentIndex].lastRevealTime = Date.now();
                }
                
                startTimer();
            } else {
                // æš‚åœ
                isPaused = true;
                overlay.style.display = 'flex';
                stopTimer();
                
                // è®°å½•å½“å‰å·²ç”¨æ€»æ—¶é•¿
                pausedTimeDuration = (Date.now() - startTime) / 1000;
                
                // è®°å½•æš‚åœå‰é‚£ä¸€åˆ»çš„æ€è€ƒæ—¶é—´åˆ°å½“å‰å¥
                if (currentIndex >= 0 && lineStats[currentIndex]) {
                    lineStats[currentIndex].duration += (Date.now() - lineStats[currentIndex].lastRevealTime) / 1000;
                }

                // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°
                saveOrUpdateHistory(currentPoemTitle, currentPoemContent, currentIndex, 'in-progress', pausedTimeDuration, lineStats);
            }
        }

        function revealNext() {
            if (isStudyMode || isPaused) return; 
            if (currentIndex >= linesData.length - 1) return finish();

            if (currentIndex >= 0 && lineStats[currentIndex]) {
                const duration = (Date.now() - lineStats[currentIndex].lastRevealTime) / 1000;
                lineStats[currentIndex].duration += duration;
            }

            currentIndex++;
            
            const els = document.querySelectorAll('.poem-line');
            if (els[currentIndex]) {
                els[currentIndex].classList.add('revealed');
                els[currentIndex].scrollIntoView({behavior: "smooth", block: "center"});
                
                lineStats[currentIndex].lastRevealTime = Date.now();
                saveOrUpdateHistory(currentPoemTitle, currentPoemContent, currentIndex, 'in-progress', (Date.now()-startTime)/1000, lineStats);
            }
            updateProgress();
        }

        function hidePrev() {
            if (isStudyMode || isPaused || currentIndex < 0) return;
            
            if (currentIndex >= 0 && lineStats[currentIndex]) {
                lineStats[currentIndex].retreats++;
                const duration = (Date.now() - lineStats[currentIndex].lastRevealTime) / 1000;
                lineStats[currentIndex].duration += duration;
            }

            const newIndex = Math.max(-1, currentIndex - hideStep);
            const els = document.querySelectorAll('.poem-line');
            for(let i=currentIndex; i>newIndex; i--) if(i>=0 && els[i]) els[i].classList.remove('revealed');
            
            currentIndex = newIndex;
            
            if(currentIndex >= 0 && els[currentIndex]) {
                els[currentIndex].scrollIntoView({behavior: "smooth", block: "center"});
                lineStats[currentIndex].lastRevealTime = Date.now();
            } else {
                poemView.scrollTo({top:0, behavior:'smooth'});
            }

            saveOrUpdateHistory(currentPoemTitle, currentPoemContent, currentIndex, 'in-progress', (Date.now()-startTime)/1000, lineStats);
            updateProgress();
        }

        // --- å­¦ä¹ æ¨¡å¼ (åˆ‡æ¢) ---
        function toggleStudyMode() {
            if (isPaused) return; // æš‚åœæ—¶ä¸èƒ½åˆ‡æ¢å­¦ä¹ æ¨¡å¼

            const btns = document.querySelectorAll('#btn-study-reveal, .btn-study');
            
            if (isStudyMode) {
                // é€€å‡ºå­¦ä¹ æ¨¡å¼
                isStudyMode = false;
                btns.forEach(b => b.classList.remove('study-active'));
                
                // æ¢å¤é®ç½© (éšè— currentIndex ä¹‹åçš„è¡Œ)
                const els = document.querySelectorAll('.poem-line');
                els.forEach((el, i) => {
                    if (i > currentIndex) el.classList.remove('revealed');
                });

                // æ¢å¤è®¡æ—¶å™¨
                // æ³¨æ„ï¼šå­¦ä¹ æœŸé—´çš„æ—¶é—´ä¸åº”è¯¥è®¡å…¥æ€»æ—¶é—´
                // é€»è¾‘ï¼šstartTime = Date.now() - (å­¦ä¹ æ¨¡å¼å¼€å§‹å‰å·²ç”¨çš„æ—¶é—´)
                startTime = Date.now() - (pausedTimeDuration * 1000);
                
                // é‡ç½®å½“å‰è¡Œçš„æ€è€ƒè®¡æ—¶ç‚¹
                if(currentIndex >= 0 && lineStats[currentIndex]) {
                    lineStats[currentIndex].lastRevealTime = Date.now();
                }

                startTimer();

            } else {
                // è¿›å…¥å­¦ä¹ æ¨¡å¼
                isStudyMode = true;
                btns.forEach(b => b.classList.add('study-active'));
                
                stopTimer();
                // è®°å½•è¿›å…¥å­¦ä¹ æ¨¡å¼å‰çš„æ—¶é—´ï¼Œä»¥ä¾¿é€€å‡ºæ—¶æ¢å¤
                pausedTimeDuration = (Date.now() - startTime) / 1000;
                
                // å±•å¼€å…¨æ–‡
                document.querySelectorAll('.poem-line').forEach(el => el.classList.add('revealed'));
            }
        }

        // --- å®Œæˆä¸ç»“ç®— ---
        function finish() {
            stopTimer();
            const totalTime = (Date.now() - startTime) / 1000;
            
            if (currentIndex >= 0 && lineStats[currentIndex]) {
                lineStats[currentIndex].duration += (Date.now() - lineStats[currentIndex].lastRevealTime) / 1000;
            }

            // ä¿å­˜å®ŒæˆçŠ¶æ€åŠæœ€ç»ˆç»Ÿè®¡
            saveOrUpdateHistory(currentPoemTitle, currentPoemContent, currentIndex, 'completed', totalTime, lineStats);

            const bestTime = loadBestTime(currentPoemTitle);
            const totalRetreats = lineStats.reduce((sum, item) => sum + item.retreats, 0);
            const validStats = lineStats.slice(1); 
            const hardest = [...validStats].sort((a,b) => b.retreats - a.retreats).filter(i => i.retreats > 0).slice(0, 3);
            const longest = [...validStats].sort((a,b) => b.duration - a.duration).filter(i => i.duration > 1).slice(0, 3);

            document.getElementById('completion-title').textContent = currentPoemTitle;
            document.getElementById('score-time').textContent = formatTime(totalTime);
            document.getElementById('score-best').textContent = bestTime ? formatTime(bestTime) : formatTime(totalTime);
            document.getElementById('score-retreats').textContent = totalRetreats;
            
            const timeEl = document.getElementById('score-time');
            if (bestTime && totalTime < bestTime) {
                timeEl.classList.add('score-highlight');
                timeEl.innerHTML += ' <span style="font-size:12px">æ–°çºªå½•!</span>';
            } else {
                timeEl.classList.remove('score-highlight');
            }

            const renderList = (arr, type) => {
                if(arr.length === 0) return '<li><span>å®Œç¾é€šè¿‡ï¼Œæ— æ˜æ˜¾å¡é¡¿ï¼ğŸ‰</span></li>';
                return arr.map(item => `
                    <li>
                        <span>${linesData[item.index]}</span>
                        <span class="analysis-tag ${type === 'retreat' ? 'tag-red' : 'tag-blue'}">
                            ${type === 'retreat' ? item.retreats + 'æ¬¡' : formatDuration(item.duration)}
                        </span>
                    </li>
                `).join('');
            };

            document.getElementById('list-hardest').innerHTML = renderList(hardest, 'retreat');
            document.getElementById('list-longest').innerHTML = renderList(longest, 'duration');

            completionView.style.display = 'flex';
            setTimeout(() => completionView.style.opacity = 1, 50);
            renderMain();
        }

        function exitMidSession() {
            if(confirm("ç¡®å®šé€€å‡ºï¼Ÿ(è¿›åº¦å·²ä¿å­˜)")) {
                if(!isStudyMode && !isPaused) {
                    const currentTime = (Date.now() - startTime) / 1000;
                    saveOrUpdateHistory(currentPoemTitle, currentPoemContent, currentIndex, 'in-progress', currentTime, lineStats);
                }
                goToHomeAfterCompletion(false);
            }
        }

        function goToHomeAfterCompletion(completed=true) {
            completionView.style.opacity = 0; poemViewContainer.style.opacity = 0;
            // é‡ç½®çŠ¶æ€
            isStudyMode = false;
            isPaused = false;
            document.getElementById('pause-overlay').style.display = 'none';

            setTimeout(() => {
                completionView.style.display = 'none'; poemViewContainer.style.display = 'none';
                updateProgress(true); 
                renderMain();
                switchView(completed ? 'review-view' : lastViewId);
            }, 300);
        }

        function updateProgress(reset = false) {
            const revealedCount = currentIndex + 1;
            let pct = reset ? 0 : (linesData.length ? Math.round((revealedCount / linesData.length) * 100) : 0);
            if (revealedCount === linesData.length && !reset) pct = 100;
            
            const fill = document.getElementById('progress-fill');
            const num = document.getElementById('progress-percent');
            fill.style.width = pct + '%';
            num.textContent = pct + '%';
            num.style.left = Math.min(Math.max(pct, 2), 98) + '%';
            document.body.classList.toggle('is-reciting', pct > 0 && !reset);
        }
        
        function clearHistory() {
             if(confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰å†å²è®°å½•ï¼Ÿ")) { 
                localStorage.removeItem('poemHistory'); 
                renderMain(); 
            }
        }
        function restartCurrentPoem() {
            if(confirm("ç¡®å®šé‡æ–°å¼€å§‹ï¼Ÿ")) { startRecitation(currentPoemTitle+'\n'+currentPoemContent, -1); }
        }

        // --- äº‹ä»¶ç»‘å®š ---
        document.getElementById('nav-bar').addEventListener('click', e => { 
            if(e.target.dataset.view) switchView(e.target.dataset.view);
        });
        document.getElementById('hide-step-input').addEventListener('change', function() { 
            hideStep = parseInt(this.value); saveSettings();
        });
        searchInput.addEventListener('input', renderLibrary);
        categoryTagsContainer.addEventListener('click', e => {
            if(e.target.classList.contains('category-tag')) {
                document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                currentCategory = e.target.dataset.cat;
                renderLibrary();
            }
        });
        
        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', e => {
            if(poemViewContainer.style.display !== 'flex' || isMobile() || isStudyMode || isPaused) return; 
            if(completionView.style.display === 'flex') return;
            if(['ArrowRight', 'ArrowDown', ' ', 'Enter'].includes(e.key)) { e.preventDefault(); revealNext(); }
            else if(['ArrowLeft', 'ArrowUp', 'Backspace'].includes(e.key)) { e.preventDefault(); hidePrev(); }
            else if(e.key === 'Escape') exitMidSession();
        });
        // é¼ æ ‡æ§åˆ¶
        document.addEventListener('contextmenu', e => {
            if(!isMobile() && poemViewContainer.style.display === 'flex' && completionView.style.display !== 'flex' && !isStudyMode && !isPaused) { 
                e.preventDefault(); revealNext(); 
            }
        });
        document.addEventListener('click', e => {
            if(!isMobile() && poemViewContainer.style.display === 'flex' && completionView.style.display !== 'flex' && !isStudyMode && !isPaused) {
                if(!e.target.closest('.top-icon-btn') && !e.target.closest('.mobile-controls')) hidePrev();
            }
        });
        
        // æ–‡ä»¶ä¸Šä¼ 
        document.getElementById('file-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                poemInput.value = e.target.result;
                document.querySelector('.input-wrapper').style.borderColor = '#34a853';
                setTimeout(() => document.querySelector('.input-wrapper').style.borderColor = '#edf2f7', 500);
            };
            reader.readAsText(file, 'UTF-8');
            e.target.value = '';
        });

        window.onload = function() { loadSettings(); renderMain(); };

    </script>
</body>
</html>
